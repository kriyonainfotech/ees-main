import{r as a,U as E,j as e,A as R,d as D,P as L,B as c,h as M,W as $,c as v}from"./index-RHbtK-zp.js";const B="https://ees121.com",H=5*1024*1024,O=({onClose:s,onSubmit:g})=>{localStorage.getItem("token");const[r,C]=a.useState(1),[b,k]=a.useState(""),[u,m]=a.useState(""),[n,x]=a.useState({bankAccountNumber:"",ifscCode:"",accountHolderName:""}),[j,S]=a.useState(0),[w,y]=a.useState(!1),[d,h]=a.useState(null),[l,o]=a.useState({bankProof:null,panFront:null,panBack:null}),N=a.useRef(null),p=[121,200,300,400,500],A=(t,i)=>{const f=t.target.files[0];if(f){if(f.size>2*1024*1024){c.error("File size should not exceed 2MB.");return}URL.createObjectURL(f),o(P=>({...P,[i]:f}))}},F=t=>{h(t),y(!0)},I=()=>{const t=N.current.getScreenshot();t&&fetch(t).then(i=>i.blob()).then(i=>{const f=new File([i],`${d}.jpeg`,{type:"image/jpeg"});if(f.size>H){c.error("Captured image is too large. Please try again.");return}o(P=>({...P,[d]:f})),y(!1)})},U=()=>{if(r===1){if(!u&&(!n.bankAccountNumber||!n.ifscCode)){c.error("Please provide either UPI ID or complete bank details.");return}}else if(r===2){const t=b&&parseInt(b,10);if(t<120){c.error("Minimum withdrawal amount is ₹120");return}S(t)}C(r+1)},W=async()=>{if(/^[A-Z]{4}0[A-Z0-9]{6}$/.test(n.ifscCode)||c.error("Invalid IFSC code. It must be 11 characters long."),!l.bankProof||!l.panFront||!l.panBack){c.error("Please upload or capture all required documents.");return}const t=new FormData;t.append("bankProof",l.bankProof),t.append("panCardfront",l.panFront),t.append("panCardback",l.panBack),t.append("upiId",u||""),t.append("bankAccountNumber",n.bankAccountNumber||""),t.append("accountHolderName",n.accountHolderName||""),t.append("ifscCode",n.ifscCode||""),t.append("amount",j);try{const i=await v.post(`${B}/withdrawal/request`,t,{withCredentials:!0});console.log(i,"response of withdrawe request"),i.status===200?(c.success("Withdrawal request submitted successfully!"),g(payload),s()):c.error(i.message||"Failed to submit request")}catch(i){console.error("Error:",i),c.error("Something went wrong!")}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 p-5 ",children:e.jsx("div",{className:"bg-white w-full max-w-md rounded-lg shadow-lg p-4 relative lg:mt-20",children:e.jsxs("div",{className:"max-h-[50vh] lg:max-h-[60vh] overflow-y-auto p-2",children:[e.jsx("button",{className:"absolute top-2 right-4 bg-gray-200 hover:bg-gray-300 text-black rounded-full w-8 h-8 flex items-center justify-center",onClick:s,children:"✕"}),e.jsx("h2",{className:"text-xl font-semibold mb-4",children:r===1?"Enter Payment Details":r===2?"Select Withdrawal Amount":"Upload Documents"}),r===1&&e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2",children:[e.jsx("input",{type:"radio",checked:!!u,onChange:()=>m("")})," Use UPI"]}),e.jsx("input",{type:"text",className:"w-full border p-2 mb-4",placeholder:"Enter UPI ID",value:u,onChange:t=>m(t.target.value)}),e.jsxs("label",{className:"block mb-2",children:[e.jsx("input",{type:"radio",checked:!u,onChange:()=>m(null)})," Use Bank Details"]}),!u&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",className:"w-full border p-2 mb-2",placeholder:"Account Number",value:n.bankAccountNumber,onChange:t=>x({...n,bankAccountNumber:t.target.value})}),e.jsx("input",{type:"text",className:"w-full border p-2 mb-2",placeholder:"IFSC Code",value:n.ifscCode,onChange:t=>x({...n,ifscCode:t.target.value})}),e.jsx("input",{type:"text",className:"w-full border p-2 mb-2",placeholder:"Account Holder Name",value:n.accountHolderName,onChange:t=>x({...n,accountHolderName:t.target.value})})]})]}),r===2&&e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:p.map(t=>e.jsxs("button",{className:`px-4 py-2 rounded-md border ${b===t?"bg-blue-600 text-white":"bg-gray-200"}`,onClick:()=>k(t),children:["₹",t]},t))}),e.jsx("input",{type:"number",value:b,onChange:t=>k(t.target.value),className:"border rounded-md p-2 mt-3 w-full"})]}),r===3&&e.jsxs("div",{children:[e.jsx("button",{className:"w-full p-2 bg-blue-600 text-white mb-2",onClick:()=>F("bankProof"),children:"Capture Bank Proof"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>A(t,"bankProof"),className:"w-full border p-2 mb-2"}),l.bankProof&&e.jsx("img",{src:URL.createObjectURL(l.bankProof),alt:"Bank Proof",className:"w-20 h-20 mt-2 rounded-md"}),e.jsx("button",{className:"w-full p-2 bg-blue-600 text-white mb-2",onClick:()=>F("panFront"),children:"Capture PAN Front"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>A(t,"panFront"),className:"w-full border p-2 mb-2"}),l.panFront&&e.jsx("img",{src:URL.createObjectURL(l.panFront),alt:"PAN Front",className:"w-20 h-20 mt-2 rounded-md"}),e.jsx("button",{className:"w-full p-2 bg-blue-600 text-white mb-2",onClick:()=>F("panBack"),children:"Capture PAN Back"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>A(t,"panBack"),className:"w-full border p-2 mb-2"}),l.panBack&&e.jsx("img",{src:URL.createObjectURL(l.panBack),alt:"PAN Back",className:"w-20 h-20 mt-2 rounded-md"})]}),w&&e.jsxs("div",{className:"mt-4",children:[e.jsx($,{ref:N,screenshotFormat:"image/jpeg",className:"w-full h-48"}),e.jsx("button",{className:"w-full p-2 bg-green-600 text-white mt-2",onClick:I,children:"Capture Image"})]}),e.jsxs("div",{className:"flex justify-between mt-4",children:[r>1&&e.jsx("button",{className:"p-2 bg-gray-400 rounded",onClick:()=>C(r-1),children:"Back"}),r<3?e.jsx("button",{className:"p-2 bg-blue-600 text-white rounded",onClick:U,children:"Next"}):e.jsx("button",{className:"p-2 bg-green-600 text-white rounded",onClick:W,children:"Submit Request"})]})]})})})},_=()=>{const{user:s}=a.useContext(E),[g,r]=a.useState(0),[C,b]=a.useState([]),[k,u]=a.useState(0),[m,n]=a.useState(!0),[x,j]=a.useState(""),[S,w]=a.useState(!1);a.useEffect(()=>{(async()=>{var h,l;if(!(s!=null&&s._id)){j("User is not authenticated"),n(!1);return}try{const o=await v.get(`${B}/referal/getUserWalletBalance/${s._id}`);console.log(o.data,"wallete"),r(o.data.walletBalance),b(o.data.earningsHistory||[])}catch(o){j(((l=(h=o==null?void 0:o.response)==null?void 0:h.data)==null?void 0:l.message)||"Error fetching wallet balance")}finally{n(!1)}})()},[s==null?void 0:s._id]);const y=()=>{if(g<120){c.warning("Minimum withdrawal amount is ₹120");return}w(!0)};return a.useEffect(()=>{let d=!0;const h=new AbortController;return(async()=>{var o,N;if(s!=null&&s._id)try{n(!0);const p=await v.get(`${B}/referal/earnings/${s._id}`,{signal:h.signal});d&&p.status===200&&(u(p.data.earnings),j(null))}catch(p){d&&(console.error("[ERROR] Failed to fetch earnings:",p),v.isCancel(p)||(j(((N=(o=p.response)==null?void 0:o.data)==null?void 0:N.message)||"Failed to fetch earnings"),c.error("Error loading earnings data.")))}finally{d&&n(!1)}})(),()=>{d=!1,h.abort()}},[s==null?void 0:s._id]),e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsx(D,{}),e.jsx(L,{}),e.jsx("div",{className:"mt-40",children:e.jsx("div",{className:"container",children:e.jsx("section",{className:"",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"wallete px-0",children:e.jsx("div",{className:"w-full flex flex-col items-center justify-center p-6 my-5 bg-red-100 rounded-lg shadow-md",children:m?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"spinner-border text-danger",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})})}):x?e.jsx("div",{className:"w-full text-center p-3 bg-red-200 text-red-800 rounded-lg",children:x}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full flex justify-end mb-4",children:e.jsx("button",{className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md disabled:bg-gray-400",onClick:y,children:m?"Loading...":`Withdraw ₹${g>=120?g:0}`})}),S&&e.jsx(O,{onClose:()=>w(!1),onSubmit:d=>{console.log("Withdrawal Request Data:",d),w(!1),c.success("Withdrawal request submitted!")}}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 w-full",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total Wallet Balance"}),m?e.jsx("div",{className:"animate-spin h-6 w-6 border-t-4 border-blue-500 rounded-full mt-2"}):e.jsxs("h3",{className:"text-3xl font-bold text-blue-600",children:["₹",g||0]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total Earnings"}),m?e.jsx("div",{className:"animate-spin h-6 w-6 border-t-4 border-green-500 rounded-full mt-2"}):e.jsxs("h3",{className:"text-3xl font-bold text-green-600",children:["₹",k||0]})]})]})]})})})})})})}),e.jsx(M,{})]})},z=a.memo(_);export{z as default};
