import{j as e,r as n,c as w,B as d,U as N,f as B,x as C,A as _,e as z,P as E,k as J}from"./index-CYSm4m1H.js";import{s as A,a as q}from"./startSilver-5oWuoMuE.js";import{f as O}from"./format-BzRktsyD.js";import{k}from"./index-BDrrRaKG.js";const Y=({currentTab:t,setCurrentTab:r})=>{const o=["Sended Request","Received Request"];return e.jsx("div",{className:"flex gap-3 sticky top-0 z-10 p-4 bg-white shadow-sm",children:o.map(s=>e.jsx("button",{className:`btn rounded-lg ${t===s?"btn-success text-white":"bg-none border-black text-black"}`,onClick:()=>r(s),children:s},s))})},D="https://ees121.com",F=({target:t,onClose:r,setData:o,userRole:s})=>{const[a,i]=n.useState(0),[c,j]=n.useState(""),v=JSON.parse(localStorage.getItem("token")),g=(u=0,x=10)=>Array.from({length:x},(R,m)=>e.jsx("img",{src:m<u?A:q,alt:"star",width:18,className:"cursor-pointer hover:opacity-80",onClick:()=>i(m+1)},m)),b=async()=>{try{const u={requestId:t.requestId,receiverId:s==="sender"?t.receiverId:t.senderId,ratingValue:a,comment:c},x=await w.post(`${D}/user/rate`,u,{headers:{Authorization:`Bearer ${v}`},withCredentials:!0});x.status===200?(d.success(x.data.message||"Rating submitted"),o(R=>R.map(m=>m.requestId===t.requestId?{...m,status:"rated",userRating:a}:m)),r()):d.error("Rating failed")}catch(u){console.log(u),d.error("Server error while rating")}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-40",children:e.jsxs("div",{className:"bg-white p-5 rounded-lg w-96",children:[e.jsxs("h3",{className:"text-lg font-bold mb-3",children:["Rate ",t.name]}),e.jsx("div",{className:"flex gap-1 mb-4",children:g(a)}),e.jsx("textarea",{rows:"3",className:"w-full border border-gray-300 rounded p-2 mb-4",placeholder:"Write a comment...",value:c,onChange:u=>j(u.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-1 bg-gray-400 text-white rounded",onClick:r,children:"Cancel"}),e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded",onClick:b,children:"Submit"})]})]})})},I="https://ees121.com",T=({request:t,userRole:r,setData:o,onRate:s})=>{var b,u,x,R,m;const{user:a}=n.useContext(N),i=JSON.parse(localStorage.getItem("token")),c=async(h,p,l)=>{try{const f=l==="cancelled"?"cancelRequest":"updateRequestStatus";(await w.post(`${I}/request/${f}`,{userId:h,requestId:p,status:l},{headers:{Authorization:`Bearer ${i}`}})).status===200?(d.success(`Request ${l}`),o(U=>U.map(S=>S.requestId===p?{...S,status:l}:S))):d.error("Failed to update request")}catch(f){console.error(f),d.error("Server error")}},j=async h=>{console.log(a,"user 2");const p=a==null?void 0:a._id;if(!p)return d.error("User not found");d.info(e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to cancel this request?"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-2",children:[e.jsx("button",{className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700",onClick:async()=>{d.dismiss();try{const{data:l}=await w.delete(`${I}/request/deleteRequest`,{data:{requestId:h,userId:p}});l.success?(d.success("Request deleted successfully!"),o(f=>f.filter(y=>y.requestId!==h))):d.error(l.message)}catch(l){console.log(l,"error in delete request"),d.error("Failed to delete request")}},children:"Yes"}),e.jsx("button",{className:"px-3 py-1 bg-gray-400 text-white rounded-md hover:bg-gray-500",onClick:()=>d.dismiss(),children:"No"})]})]}),{autoClose:!1})},v=(h=0)=>Array.from({length:10},(p,l)=>e.jsx("img",{src:l<h?A:q,alt:"star",width:16},l)),g=t.status==="completed";return e.jsxs("div",{className:"bg-white rounded-xl border overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{className:"w-full h-[250px] md:h-[350px] object-cover",src:t.profilePic||B,alt:"Profile"}),e.jsx("span",{className:`absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-semibold text-white ${t.status==="accepted"?"bg-blue-600":t.status==="completed"?"bg-green-600":t.status==="rejected"?"bg-red-600":t.status==="rated"?"bg-gray-600":"bg-yellow-500"}`,children:t.status||"Pending"})]}),e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:t.name||"Unknown User"}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("p",{className:"text-orange-600",children:((b=t.businessCategory)==null?void 0:b.join(", "))||"N/A"}),e.jsx("p",{className:"text-gray-500",children:O(new Date(t.date),"PPpp")})]}),e.jsxs("div",{className:"flex items-center mt-2 text-sm gap-1",children:[e.jsx("span",{className:"text-gray-700 pe-1",children:"Provider:"}),v(((u=t==null?void 0:t.providerRatingbySender)==null?void 0:u.value)||0),e.jsx("span",{children:((x=t==null?void 0:t.providerRatingbySender)==null?void 0:x.value)||0})]}),e.jsxs("div",{className:"flex items-center mt-1 text-sm gap-1",children:[e.jsx("span",{className:"text-gray-700 pe-1",children:"User:"}),v(((R=t==null?void 0:t.userRatingbyprovider)==null?void 0:R.value)||0),e.jsx("span",{children:((m=t==null?void 0:t.userRatingbyprovider)==null?void 0:m.value)||0})]}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2",children:[t.status==="pending"&&r==="sender"&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`tel:${t.phone}`,className:"w-full text-sm flex items-center justify-center gap-2 p-2 text-white bg-green-600 rounded-lg hover:bg-green-700",children:[e.jsx(C,{})," Contact Now"]}),e.jsx("button",{className:"w-full text-sm p-2 bg-red-600 text-white rounded-lg hover:bg-red-700",onClick:()=>j(t.requestId),children:"Delete"})]}),t.status==="pending"&&r==="receiver"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"w-full text-sm p-2 bg-green-600 text-white rounded-lg hover:bg-green-700",onClick:()=>c(t.senderId,t.requestId,"accepted"),children:"Accept"}),e.jsx("button",{className:"w-full text-sm p-2 bg-red-600 text-white rounded-lg hover:bg-red-700",onClick:()=>c(t.senderId,t.requestId,"rejected"),children:"Reject"})]}),t.status==="accepted"&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`tel:${t.phone}`,className:"w-full text-sm flex items-center justify-center gap-2 p-2 text-white bg-green-600 rounded-lg hover:bg-green-700",children:[e.jsx(C,{})," Contact Now"]}),e.jsx("button",{className:"w-full text-sm p-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700",onClick:s,children:"Completed"})]}),g&&e.jsxs("button",{className:"p-2 text-sm bg-yellow-600 text-white rounded-lg hover:bg-yellow-700",onClick:s,children:["Rate ",r==="sender"?"Provider":"User"]}),(t.status==="rejected"||t.status==="rated")&&e.jsx("button",{className:"p-2 text-sm bg-gray-600 text-white rounded-lg hover:bg-red-900",onClick:()=>j(t.requestId),children:"Remove"})]})]})]})},W=({data:t,setData:r})=>{n.useContext(N);const[o,s]=n.useState(null);return e.jsxs("div",{className:"grid grid-cols-2 xl:grid-cols-4 gap-4 mt-4",children:[t.length?t.map((a,i)=>e.jsx(T,{request:a,userRole:"sender",setData:r,onRate:()=>s(a)},i)):e.jsxs("div",{className:"col-span-12 text-center py-12",children:[e.jsx("h5",{children:"No Requests Found"}),e.jsx("p",{className:"text-gray-500",children:"Your sent requests will appear here."})]}),o&&e.jsx(F,{target:o,setData:r,userRole:"sender",onClose:()=>s(null)})]})},G=({data:t,setData:r})=>{const[o,s]=n.useState(null);return n.useContext(N),e.jsxs("div",{className:"grid grid-cols-2 xl:grid-cols-4 gap-4 mt-4",children:[t.length?t.map((a,i)=>e.jsx(T,{request:a,userRole:"receiver",setData:r,onRate:()=>s(a)},i)):e.jsxs("div",{className:"col-span-12 text-center py-12",children:[e.jsx("h5",{children:"No Requests Found"}),e.jsx("p",{className:"text-gray-500",children:"Your received requests will appear here."})]}),o&&e.jsx(F,{target:o,setData:r,userRole:"receiver",onClose:()=>s(null)})]})},P="https://ees121.com",$={pending:1,accepted:2,completed:3,rated:4,rejected:5},L=()=>{const t=JSON.parse(localStorage.getItem("token")),{user:r}=n.useContext(N),[o,s]=n.useState([]),[a,i]=n.useState([]),[c,j]=n.useState(localStorage.getItem("currentRequest")||"Sended Request"),[v,g]=n.useState(!0),b=n.useCallback(async()=>{if(!t)return k.error("Authentication required");const u=c==="Sended Request"?`${P}/request/getSentRequests`:`${P}/request/getReceivedRequests`;g(!0);try{const{data:x,status:R}=await w.get(u,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(R===200){const h=(c==="Sended Request"?x.sendedRequests:x.receivedRequests).sort((p,l)=>{const f=$[p.status]||99,y=$[l.status]||99;return f!==y?f-y:new Date(l.date)-new Date(p.date)});c==="Sended Request"?s(h):i(h)}}catch{k.error("Failed to load requests")}finally{g(!1)}},[c]);return n.useEffect(()=>{b()},[c]),n.useEffect(()=>{localStorage.setItem("currentRequest",c)},[c]),{user:r,loading:v,currentTab:c,setCurrentTab:j,sendedRequest:o,receivedRequest:a}},Q=()=>{const{currentTab:t,setCurrentTab:r,sendedRequest:o,receivedRequest:s,loading:a,user:i}=L(),[c,j]=n.useState(!1),[v,g]=n.useState([]);return n.useEffect(()=>{const b=setTimeout(()=>j(!0),50);return()=>clearTimeout(b)},[]),c?e.jsxs(e.Fragment,{children:[e.jsx(_,{}),e.jsx(z,{}),e.jsx(E,{}),e.jsx("div",{className:"mt-40",children:e.jsx("section",{className:"bg-gray-50 py-5",children:e.jsxs("div",{className:"container",children:[e.jsx(Y,{currentTab:t,setCurrentTab:r}),a?e.jsx("p",{className:"loader"}):t==="Received Request"?e.jsx(G,{data:s,user:i,setData:g}):e.jsx(W,{data:o,user:i,setData:g})]})})}),e.jsx(J,{})]}):null};export{Q as default};
