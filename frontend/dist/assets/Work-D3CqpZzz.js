import{j as e,r as n,c as v,B as i,U as N,f as T,x as S,y as C,z as k,A as U,e as z,P as B,k as _}from"./index-BFgrwAL4.js";import{s as P,a as $}from"./startSilver-5oWuoMuE.js";import{f as E}from"./format-BzRktsyD.js";import{k as I}from"./index-DkBDFfw_.js";const J=({currentTab:t,setCurrentTab:r})=>{const l=["Sended Request","Received Request"];return e.jsx("div",{className:"flex gap-3 sticky top-0 z-10 p-4 bg-white shadow-sm",children:l.map(s=>e.jsx("button",{className:`btn rounded-lg ${t===s?"btn-success text-white":"bg-none border-black text-black"}`,onClick:()=>r(s),children:s},s))})},O="https://ees121.com",A=({target:t,onClose:r,setData:l,userRole:s})=>{const[a,u]=n.useState(0),[o,p]=n.useState(""),f=JSON.parse(localStorage.getItem("token")),h=(x=0,g=10)=>Array.from({length:g},(m,c)=>e.jsx("img",{src:c<x?P:$,alt:"star",width:18,className:"cursor-pointer hover:opacity-80",onClick:()=>u(c+1)},c)),j=async()=>{try{const x={requestId:t.requestId,receiverId:s==="sender"?t.receiverId:t.senderId,ratingValue:a,comment:o},g=await v.post(`${O}/user/rate`,x,{headers:{Authorization:`Bearer ${f}`},withCredentials:!0});g.status===200?(i.success(g.data.message||"Rating submitted"),l(m=>m.map(c=>c.requestId===t.requestId?{...c,status:"rated",userRating:a}:c)),r()):i.error("Rating failed")}catch(x){console.log(x),i.error("Server error while rating")}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-40",children:e.jsxs("div",{className:"bg-white p-5 rounded-lg w-96",children:[e.jsxs("h3",{className:"text-lg font-bold mb-3",children:["Rate ",t.name]}),e.jsx("div",{className:"flex gap-1 mb-4",children:h(a)}),e.jsx("textarea",{rows:"3",className:"w-full border border-gray-300 rounded p-2 mb-4",placeholder:"Write a comment...",value:o,onChange:x=>p(x.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-1 bg-gray-400 text-white rounded",onClick:r,children:"Cancel"}),e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded",onClick:j,children:"Submit"})]})]})})},q="https://ees121.com",F=({request:t,userRole:r,setData:l,onRate:s})=>{var j,x,g;const{user:a}=n.useContext(N),u=JSON.parse(localStorage.getItem("token")),o=async(m,c,d)=>{try{const b=d==="cancelled"?"cancelRequest":"updateRequestStatus";(await v.post(`${q}/request/${b}`,{userId:m,requestId:c,status:d},{headers:{Authorization:`Bearer ${u}`}})).status===200?(i.success(`Request ${d}`),l(y=>y.map(w=>w.requestId===c?{...w,status:d}:w))):i.error("Failed to update request")}catch(b){console.error(b),i.error("Server error")}},p=async m=>{console.log(a,"user 2");const c=a==null?void 0:a._id;if(!c)return i.error("User not found");i.info(e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to cancel this request?"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-2",children:[e.jsx("button",{className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700",onClick:async()=>{i.dismiss();try{const{data:d}=await v.delete(`${q}/request/deleteRequest`,{data:{requestId:m,userId:c}});d.success?(i.success("Request deleted successfully!"),l(b=>b.filter(R=>R.requestId!==m))):i.error(d.message)}catch(d){console.log(d,"error in delete request"),i.error("Failed to delete request")}},children:"Yes"}),e.jsx("button",{className:"px-3 py-1 bg-gray-400 text-white rounded-md hover:bg-gray-500",onClick:()=>i.dismiss(),children:"No"})]})]}),{autoClose:!1})},f=(m=0)=>Array.from({length:10},(c,d)=>e.jsx("img",{src:d<m?P:$,alt:"star",className:"w-3 md:w-4"},d)),h=t.status==="completed";return e.jsxs("div",{className:`bg-white rounded-xl border shadow-sm overflow-hidden \r
             flex flex-wrap sm:flex-nowrap md:flex-col lg:flex-col`,children:[e.jsxs("div",{className:"relative w-3/12 sm:w-3/12 md:w-full h-[100px] md:h-[250px] lg:h-[300px]",children:[e.jsx("img",{className:"w-full h-full object-contain",src:t.profilePic||T,alt:"Profile"}),e.jsx("span",{className:`absolute right-4 px-2 py-0.5 rounded-full text-[10px] font-semibold text-white 
    bottom-0 
    lg:bottom-auto lg:top-2
    h-fit w-fit ${t.status==="accepted"?"bg-blue-600":t.status==="completed"?"bg-green-600":t.status==="rejected"?"bg-red-600":t.status==="rated"?"bg-gray-600":"bg-yellow-500"}`,children:t.status||"Pending"})]}),e.jsxs("div",{className:"w-9/12 sm:w-9/12 md:w-full p-3 flex flex-col justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:t.name||"Unknown User"}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("p",{className:"text-orange-600",children:((j=t.businessCategory)==null?void 0:j.join(", "))||"N/A"}),e.jsx("p",{className:"text-gray-500",children:E(new Date(t.date),"PPpp")})]}),e.jsxs("div",{className:"flex items-center mt-1 text-sm gap-0 lg:gap-1",children:[e.jsx("span",{className:"text-gray-700 pe-1",children:"User:"}),f(((x=t==null?void 0:t.userRatingbyprovider)==null?void 0:x.value)||0),e.jsx("span",{children:((g=t==null?void 0:t.userRatingbyprovider)==null?void 0:g.value)||0})]}),e.jsxs("div",{className:"mt-2 lg:mt-4 flex flex-row gap-2",children:[t.status==="pending"&&r==="sender"&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`tel:${t.phone}`,className:"w-full text-[10px] lg:text-sm flex items-center justify-center gap-2  p-2 text-white bg-green-600 rounded-lg hover:bg-green-700",children:[e.jsx(S,{})," Contact Now"]}),e.jsx("button",{className:"w-full text-[10px] p-2 lg:text-sm  bg-red-600 text-white rounded-lg hover:bg-red-700",onClick:()=>p(t.requestId),children:"Delete"})]}),t.status==="pending"&&r==="receiver"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"w-full text-[10px] p-2 lg:text-sm  bg-green-600 text-white rounded-lg hover:bg-green-700",onClick:()=>o(t.senderId,t.requestId,"accepted"),children:"Accept"}),e.jsx("button",{className:"w-full text-[10px] p-2 lg:text-sm  bg-red-600 text-white rounded-lg hover:bg-red-700",onClick:()=>o(t.senderId,t.requestId,"rejected"),children:"Reject"})]}),t.status==="accepted"&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`tel:${t.phone}`,className:"w-full text-[10px] lg:text-sm flex items-center justify-center gap-2  p-2 text-white bg-green-600 rounded-lg hover:bg-green-700",children:[e.jsx(S,{})," Contact Now"]}),e.jsx("button",{className:"w-full text-[10px] p-2 lg:text-sm  bg-yellow-600 text-white rounded-lg hover:bg-yellow-700",onClick:s,children:"Completed"})]}),h&&e.jsxs("button",{className:" lg:text-sm text-[10px] p-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700",onClick:s,children:["Rate ",r==="sender"?"Provider":"User"]}),(t.status==="rejected"||t.status==="rated")&&e.jsx("button",{className:" lg:text-sm text-[10px] bg-gray-600 text-white rounded-lg hover:bg-red-900",onClick:()=>p(t.requestId),children:"Remove"})]})]})]})},Y=({data:t,setData:r})=>{n.useContext(N);const[l,s]=n.useState(null);return e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mt-4",children:[t.length?t.map((a,u)=>e.jsx(F,{request:a,userRole:"sender",setData:r,onRate:()=>s(a)},u)):e.jsxs("div",{className:"col-span-12 text-center py-12",children:[e.jsx("h5",{children:"No Requests Found"}),e.jsx("p",{className:"text-gray-500",children:"Your sent requests will appear here."})]}),l&&e.jsx(A,{target:l,setData:r,userRole:"sender",onClose:()=>s(null)})]})},D=({data:t,setData:r})=>{const[l,s]=n.useState(null);return n.useContext(N),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mt-4",children:[t.length?t.map((a,u)=>e.jsx(F,{request:a,userRole:"receiver",setData:r,onRate:()=>s(a)},u)):e.jsxs("div",{className:"col-span-12 text-center py-12",children:[e.jsx("h5",{children:"No Requests Found"}),e.jsx("p",{className:"text-gray-500",children:"Your received requests will appear here."})]}),l&&e.jsx(A,{target:l,setData:r,userRole:"receiver",onClose:()=>s(null)})]})},W=()=>{const t=JSON.parse(localStorage.getItem("token")),{user:r}=n.useContext(N),[l,s]=n.useState([]),[a,u]=n.useState([]),[o,p]=n.useState(localStorage.getItem("currentRequest")||"Sended Request"),[f,h]=n.useState(!0),j=n.useCallback(async()=>{if(!t)return I.error("Authentication required");const x=o==="Sended Request"?`${k}/request/getSentRequests`:`${k}/request/getReceivedRequests`;h(!0);try{const{data:g,status:m}=await v.get(x,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(m===200){const d=(o==="Sended Request"?g.sendedRequests:g.receivedRequests).sort((b,R)=>{const y=C[b.status]||99,w=C[R.status]||99;return y!==w?y-w:new Date(R.date)-new Date(b.date)});o==="Sended Request"?s(d):u(d)}}catch{I.error("Failed to load requests")}finally{h(!1)}},[o]);return n.useEffect(()=>{j()},[o]),n.useEffect(()=>{localStorage.setItem("currentRequest",o)},[o]),{user:r,loading:f,currentTab:o,setCurrentTab:p,sendedRequest:l,receivedRequest:a}},H=()=>{const{currentTab:t,setCurrentTab:r,sendedRequest:l,receivedRequest:s,loading:a,user:u}=W(),[o,p]=n.useState(!1),[f,h]=n.useState([]);return n.useEffect(()=>{const j=setTimeout(()=>p(!0),50);return()=>clearTimeout(j)},[]),o?e.jsxs(e.Fragment,{children:[e.jsx(U,{}),e.jsx(z,{}),e.jsx(B,{}),e.jsx("div",{className:"mt-40",children:e.jsx("section",{className:"bg-gray-50 py-5",children:e.jsxs("div",{className:"container",children:[e.jsx(J,{currentTab:t,setCurrentTab:r}),a?e.jsx("p",{className:"loader"}):t==="Received Request"?e.jsx(D,{data:s,user:u,setData:h}):e.jsx(Y,{data:l,user:u,setData:h})]})})}),e.jsx(_,{})]}):null};export{H as default};
