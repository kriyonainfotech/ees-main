import{r as d,U as $,j as e,f as A,x as R,B as l,c as p}from"./index-xKEadWzh.js";import{s as U,a as z}from"./startSilver-5oWuoMuE.js";import{f as E}from"./format-BzRktsyD.js";const f="https://ees121.com",O=({sendedRequest:n,setSendedRequest:j})=>{const{user:m}=d.useContext($),[u,b]=d.useState(null),[B,q]=d.useState(null),[w,v]=d.useState(0),[y,k]=d.useState(""),N=JSON.parse(localStorage.getItem("token"));console.log(n,"sendedRequest");const x=t=>{const a=m==null?void 0:m._id;if(!a){l.error("User not found!");return}l.info(e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to cancel this request?"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-2",children:[e.jsx("button",{className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700",onClick:async()=>{var r,o;l.dismiss();try{const{data:s}=await p.delete(`${f}/request/deleteRequest`,{data:{requestId:t,userId:a}});s.success?(l.success("Request deleted successfully!"),setTimeout(()=>{window.location.reload()},4e3)):l.error(s.message||"Failed to delete request.")}catch(s){console.error("Error deleting request:",s),l.error(((o=(r=s.response)==null?void 0:r.data)==null?void 0:o.message)||"An error occurred while deleting the request.")}},children:"Yes"}),e.jsx("button",{className:"px-3 py-1 bg-gray-400 text-white rounded-md hover:bg-gray-500",onClick:()=>l.dismiss(),children:"No"})]})]}),{autoClose:!1,closeOnClick:!1})},S=async(t,a,r)=>{try{(await p.post(`${f}/request/updateRequestStatus`,{userId:t,requestId:a,status:r},{headers:{Authorization:`Bearer ${N}`}})).status===200?(l.success(`Request ${r}`),q(r),j(s=>s.map(i=>i.requestId===a?{...i,status:r}:i))):l.error("Failed to update request status")}catch{l.error("Failed to update request status")}},I=t=>{b(t)},C=()=>{b(null),v(0)},F=async(t,a,r,o)=>{var s,i;if(console.log(t,a,r,o,"senderId, requestId, ratingValue, comment"),!!u)try{const c=await p.post(`${f}/user/rate`,{receiverId:t,requestId:a,ratingValue:r,comment:o},{withCredentials:!0,headers:{Authorization:`Bearer ${N}`}});c.status===200?(l.success(c.data.message||"Rating submitted successfully"),j(P=>P.map(g=>g.requestId===a?{...g,userRating:r,status:"rated"}:g)),C()):(console.log(c,"response"),l.error("Failed to submit rating."))}catch(c){console.log(c,"error"),l.error(((i=(s=c==null?void 0:c.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to submit rating.")}},h=(t=0,a=10,r=!1)=>Array.from({length:a},(o,s)=>e.jsx("img",{src:s<t?U:z,alt:s<t?"Filled Star":"Empty Star",width:16,className:`cursor-pointer ${r?"hover:opacity-80":""}`,onClick:r?()=>v(s+1):void 0},s));return e.jsxs("div",{className:"mt-0",children:[e.jsx("section",{children:e.jsx("div",{className:"grid grid-cols-2 xl:grid-cols-4 gap-4 mt-4",children:n!=null&&n.length?n.map((t,a)=>{var r,o,s,i,c;return e.jsxs("div",{title:t.status==="rejected"?"Receiver has rejected the request.":t.status==="completed"?"Request completed, rate the user":t.status==="accepted"?"Request accepted, contact the user":"",className:"bg-white rounded-xl border overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{className:"w-full h-[250px] md:h-[350px] object-cover object-center",src:t.profilePic||A,alt:"Profile"}),e.jsx("span",{className:`absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-semibold ${t.status==="accepted"?"bg-blue-600":t.status==="completed"?"bg-green-600":t.status==="rejected"?"bg-red-600":"bg-yellow-500"} text-white`,children:t.status||"Pending"})]}),e.jsxs("div",{className:"p-3 w-full sm:w-full",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:t.name||"Unknown User"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mt-2",children:[e.jsx("p",{className:"text-orange-600 text-sm font-medium capitalize",children:((r=t.businessCategory)==null?void 0:r.join(", "))||"N/A"}),e.jsx("p",{className:"text-xs text-gray-500",children:E(new Date(t.date),"PPpp")})]}),e.jsxs("div",{className:"flex flex-wrap items-center mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-800 pe-2 whitespace-nowrap",children:"Provider Rating"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:h(((o=t==null?void 0:t.providerRatingbySender)==null?void 0:o.value)||0,10)}),e.jsx("span",{className:"ml-1 text-gray-700",children:((s=t==null?void 0:t.providerRatingbySender)==null?void 0:s.value)||0})]}),e.jsxs("div",{className:"flex flex-wrap items-center mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-800 pe-2 whitespace-nowrap",children:"User Rating:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:h(((i=t==null?void 0:t.userRatingbyprovider)==null?void 0:i.value)||0,10)}),e.jsx("span",{className:"ml-1 text-gray-700",children:((c=t==null?void 0:t.userRatingbyprovider)==null?void 0:c.value)||0})]}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2 w-full",children:[t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`tel:${t.phone}`,className:"w-full sm:flex-1 text-sm flex items-center justify-center gap-2 p-2 text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(R,{})," Contact Now"]}),e.jsx("button",{className:"w-full sm:w-auto p-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition",onClick:()=>x(t.requestId),children:"Delete"})]}),t.status==="accepted"&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`tel:${t.phone}`,className:"w-full sm:flex-1 flex items-center justify-center gap-2 p-2 text-sm text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(R,{})," Contact Now"]}),e.jsx("button",{className:"w-full sm:w-auto p-2 bg-blue-600 text-sm text-white rounded-lg hover:bg-blue-700 transition",onClick:()=>S(t.receiverId,t.requestId,"completed"),children:"Completed"})]}),t.status==="completed"&&e.jsx("button",{className:"p-2 text-sm w-full bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition",onClick:()=>I(t),children:"Rate Service Provider"}),t.status==="cancelled"&&e.jsx("button",{className:"w-full sm:w-auto p-2 bg-red-600 text-white rounded-lg hover:bg-red-900 transition",onClick:()=>x(t.requestId),children:"Delete Request"}),(t.status==="rejected"||t.status==="rated")&&e.jsx("button",{className:"w-full sm:w-auto p-2 bg-gray-600 text-white rounded-lg hover:bg-red-900 transition",onClick:()=>x(t.requestId),children:"Remove"})]})]})]},a)}):e.jsxs("div",{className:"col-span-12 text-center py-12",children:[e.jsx("h5",{children:"No Requests Found"}),e.jsx("p",{className:"text-gray-500",children:"Your sent requests will appear here."})]})})}),u&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between pb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-1",children:["Rate ",u.name]}),e.jsx("div",{className:"flex justify-center",children:h(w,10,!0)})]}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-md p-2 mb-4 resize-none",rows:3,placeholder:"Write a comment ...",value:y,onChange:t=>k(t.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-400 text-white rounded-lg",onClick:C,children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg",onClick:()=>F(u.receiverId,u.requestId,w,y),children:"Submit"})]})]})})]})};export{O as default};
