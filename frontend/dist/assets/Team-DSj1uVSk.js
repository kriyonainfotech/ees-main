import{r,U as g,j as e,L as p,c as N,A as S,e as w,P as C,k as L}from"./index-TKWuuJjr.js";const E="https://ees121.com",_=()=>{const{user:s}=r.useContext(g),[o,m]=r.useState([]),[h,c]=r.useState(!0),[j,x]=r.useState(null);return r.useEffect(()=>{(async()=>{var n,i;if(s!=null&&s._id){c(!0);try{const a=await N.get(`${E}/referal/getReferredBy/${s._id}`);a.status===200?(m(a.data.referredBy),console.log(a.data,"referdby")):x("Failed to fetch referredby")}catch(a){console.error("Error fetching referredby:",a),x(((i=(n=a.response)==null?void 0:n.data)==null?void 0:i.message)||"Something went wrong")}finally{c(!1)}}})()},[s==null?void 0:s._id]),h?e.jsx("p",{children:"Loading referredby..."}):j?e.jsxs("p",{children:["Error: ",j]}):e.jsxs("div",{className:"text-start mt-4",children:[e.jsx("p",{className:"text-lg lg:text-2xl font-semibold pb-2",children:"ReferredBy"}),e.jsx("div",{className:"col-md-12",children:e.jsx("div",{children:e.jsx(p,{className:"list-group",children:o.length>0?o.map((d,n)=>e.jsxs("div",{className:"alert alert-primary",children:[e.jsx("h5",{children:d.name}),e.jsx("p",{children:e.jsx(p,{children:d.phone})})]},n)):e.jsx("div",{className:"alert alert-primary",children:"No Referrer found."})})})})]})},U="https://ees121.com",$=()=>{const{user:s}=r.useContext(g),[o,m]=r.useState([]),[h,c]=r.useState([]),[j,x]=r.useState({direct:0,total:0}),[d,n]=r.useState(!0),[i,a]=r.useState(""),[y,v]=r.useState("");r.useEffect(()=>{(async()=>{if(!(s!=null&&s._id)){a("User is not authenticated"),n(!1);return}try{const t=await N.get(`${U}/referal/getreferrals/${s._id}`);console.log(t.data,"Referral Data");const u=t.data.referredUsers.sort((f,R)=>f.name.localeCompare(R.name));m(u),x(t.data.referralCounts),n(!1),c(t.data.referredUsers)}catch{a("Error fetching data"),n(!1)}})()},[s==null?void 0:s._id]);const b=l=>{const t=l.target.value.toLowerCase();v(t);const u=o.filter(f=>f.name.toLowerCase().includes(t)||f.phone.includes(t));c(u)};return e.jsxs("div",{className:"mt-2",children:[i&&e.jsx("div",{className:"alert alert-danger",children:i}),e.jsxs("div",{className:"text-start",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-end pb-2",children:[e.jsx("div",{children:e.jsx("p",{className:"text-lg lg:text-2xl font-semibold",children:"Your Referrals"})}),e.jsx("div",{className:"search-container",children:e.jsx("input",{type:"text",value:y,onChange:b,placeholder:"Search by name or phone",className:"form-control custom-search-input"})})]}),d?e.jsxs("div",{children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("p",{children:"Loading referrals..."})]}):e.jsx("div",{className:"list-group",children:h.length>0?h.map((l,t)=>e.jsx("div",{className:"alert alert-success p-4 rounded-lg shadow-md mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"",children:[e.jsx("strong",{children:"User Name:"})," ",l.name]}),e.jsx("p",{children:e.jsxs("a",{href:`tel:${l.phone}`,className:"text-md text-blue-600 hover:underline",children:[e.jsx("strong",{children:"Call: "}),l.phone]})})]}),e.jsxs("div",{className:"text-end",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Referrals:"})," ",l.secondLevelReferralCount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment Verified:"})," ",l.paymentVerified?"✅ Yes":"❌ No"]})]})]})},t)):e.jsx("div",{className:"alert alert-warning text-center p-4 rounded-lg",children:"No referrals found."})})]})]})},P=()=>(r.useState("referral"),e.jsxs(e.Fragment,{children:[e.jsx(S,{}),e.jsx(w,{}),e.jsx(C,{}),e.jsx("div",{className:"py-28",children:e.jsx("section",{className:"",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"raffral w-100",children:[e.jsx(_,{}),e.jsx($,{})]})})})})}),e.jsx(L,{})]}));export{P as default};
