import{r as i,u as X,j as e,q as ee,s as se,S as te,H as ae,L as re,c as u,B as c}from"./index-CYSm4m1H.js";const j="https://ees121.com",ne=({user:t,onClose:D,onApprove:I,setSelectedUser:w})=>{var T,R,_,Y,H,K,M,O,V,q,J,G,Q;const[b,P]=i.useState(null),[g,L]=i.useState(!1),[N,p]=i.useState(t.permanentAddress||""),[h,S]=i.useState(t.aadharNumber||""),[y,x]=i.useState(!1),[z,U]=i.useState(t.profilePic),[A,F]=i.useState(t._id),$=(t==null?void 0:t.paymentHistory)||[],s=$.length>0?(T=$[0])==null?void 0:T.status:"N/A",r=[t.frontAadhar,t.backAadhar];if(!t)return null;const m=async()=>{var a,l,E;console.log(N,h,A,"permanentAddress, aadharNumber");try{x(!0);const d=await u.put(`${j}/auth/updateUserAddressAndAadhar`,{permanentAddress:N,aadharNumber:h,userId:A});console.log(d.data),d.status===200&&c.success((a=d==null?void 0:d.data)==null?void 0:a.message)}catch(d){console.log("Error updating user details:",d),c.error(((E=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:E.message)||"Failed to update user details")}finally{x(!1)}},o=a=>{P(a)},n=()=>{P(null)},f=a=>{P(l=>(l+a+r.length)%r.length)},C=()=>{c.info(e.jsxs("div",{children:["Are you sure you want to reset eKYC? This action will permanently remove all KYC related data.",e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsx("button",{className:"bg-red-600 text-white px-3 py-1 rounded-md",onClick:B,children:"Yes"}),e.jsx("button",{className:"bg-gray-400 text-white px-3 py-1 rounded-md",onClick:()=>c.dismiss(),children:"No"})]})]}),{autoClose:!1,closeOnClick:!1})},B=async()=>{var a,l,E;c.dismiss();try{x(!0);const d=await u.post(`${j}/auth/reset-ekyc`,{userId:A});if(d.status===200){c.success((a=d==null?void 0:d.data)==null?void 0:a.message);const W={...t,ekyc:null,frontAadhar:null,backAadhar:null};w(W),D()}}catch(d){console.error("Error deleting Aadhar:",d),c.error(((E=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:E.message)||"Failed to delete Aadhar images")}finally{x(!1)}},k=async()=>{try{x(!0);const a=await fetch(`${j}/auth/update-profile-pic`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t._id,profilePic:"https://res.cloudinary.com/dcfm0aowt/image/upload/v1739604108/user/phnbhd4onynoetzdxqjp.jpg"})}),l=await a.json();console.log(l,"response of allow reset"),a.ok?(U(l.profilePic),c.success("Profile picture updated successfully!")):c.error(l.message||"Failed to update profile picture.")}catch(a){console.log("API Error:",a),c.error("Something went wrong while updating profile picture.")}finally{x(!1)}},v=async a=>{try{const l=await u.post(`${j}/payment/capture-payment`,{paymentId:a,userId:A});console.log(l,"data"),alert(l.data.message)}catch{alert("Error capturing payment")}},Z=async()=>{try{const a=await u.post(`${j}/payment/verify-capture-payment`,{userId:t._id});a.data.success?c("Payment verified successfully!"):alert("Error: "+a.data.message)}catch(a){console.error("Error verifying payment:",a),c("Something went wrong!")}};return e.jsxs("div",{className:"modal-overlay fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:[e.jsxs("div",{className:"modal-content bg-white p-2 rounded shadow-lg w-full sm:w-3/4 md:w-1/2 lg:w-1/3 max-w-4xl h-[80vh] overflow-hidden",children:[e.jsx("h2",{className:"text-xl font-bold py-3 text-center border",children:"User Details"}),e.jsx("div",{className:"modal-body overflow-y-auto",children:e.jsx("table",{className:"table-auto w-full border-collapse border border-gray-300 bg-light",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Profile Picture"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 flex items-center justify-between gap-2",children:[e.jsx("img",{src:z,width:50,alt:"Profile",className:"cursor-pointer",onClick:()=>L(!0)}),e.jsx("button",{onClick:k,className:"bg-blue-500 text-white px-3 py-1 rounded",disabled:y,children:y?"Updating...":"Allow Update"})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Name"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.name})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Email"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.email})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Contact"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.phone})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Payment Status"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 flex justify-between font-semibold text-blue-600",children:[e.jsx("p",{children:s||"N/A"}),s==="authorized"&&e.jsx("div",{className:"flex gap-2 align-items-center",children:e.jsx("button",{onClick:()=>{var a;return v((a=$[0])==null?void 0:a.paymentId)},className:"bg-green-500 text-white px-3 py-1 rounded",children:"Capture Payment"})}),!t.paymentVerified&&e.jsx("button",{className:"bg-green-500 text-white px-3 py-1 rounded",onClick:Z,children:"Verify Payment"})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:`${(R=t==null?void 0:t.address)==null?void 0:R.area} ${(_=t==null?void 0:t.address)==null?void 0:_.city} ${(Y=t==null?void 0:t.address)==null?void 0:Y.state} ${(H=t==null?void 0:t.address)==null?void 0:H.country} ${(K=t==null?void 0:t.address)==null?void 0:K.pincode}`})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Name"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.businessName})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Category"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 capitalize",children:t.businessCategory})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.businessAddress})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Aadhar"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 flex items-center justify-between gap-2",children:[r.filter(Boolean).length>0?e.jsx("div",{className:"flex gap-2",children:r.map((a,l)=>a&&e.jsx("img",{src:a,width:50,alt:`Aadhar ${l+1}`,className:"cursor-pointer",onClick:()=>o(l)},l))}):e.jsx("span",{className:"",children:"N/A"}),r.filter(Boolean).length>0&&e.jsx("div",{className:"flex flex-col justify-center",children:e.jsx("button",{onClick:C,className:"bg-yellow-500 text-white btn-sm px-4 py-1 rounded",disabled:y,children:y?"Deleting...":"Reset e-KYC"})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Permanent Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:N||"N/A"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Aadhar Number"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:h||"N/A"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Account Holder Name"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:((M=t==null?void 0:t.ekyc)==null?void 0:M.accountHolderName)||"N/A"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Bank Account Number"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:((O=t==null?void 0:t.ekyc)==null?void 0:O.bankAccountNumber)||"N/A"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"IFSC Code"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:((V=t==null?void 0:t.ekyc)==null?void 0:V.ifscCode)||"N/A"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Bank Proof"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:(q=t==null?void 0:t.ekyc)!=null&&q.bankProof?e.jsx("img",{src:t.ekyc.bankProof,width:50,alt:"Bank Proof",className:"cursor-pointer"}):e.jsx("span",{className:"",children:"N/A"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"PAN Card Front"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:(J=t==null?void 0:t.ekyc)!=null&&J.panCardfront?e.jsx("img",{src:t.ekyc.panCardfront,width:50,alt:"PAN Card Front",className:"cursor-pointer"}):e.jsx("span",{className:"text-gray-800",children:"N/A"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"PAN Card Back"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:(G=t==null?void 0:t.ekyc)!=null&&G.panCardback?e.jsx("img",{src:t.ekyc.panCardback,width:50,alt:"PAN Card Back",className:"cursor-pointer"}):e.jsx("span",{className:"",children:"N/A"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"eKYC Status"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t!=null&&t.ekyc?(Q=t==null?void 0:t.ekyc)==null?void 0:Q.status:"N/A"})]})]})})}),e.jsx("div",{className:"flex justify-end m-0 gap-1 ",children:e.jsx("button",{onClick:D,className:"btn btn-secondary w-full sm:w-auto",children:"Close"})})]}),b!==null&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-[60]",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg flex relative",children:[e.jsx("button",{onClick:n,className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full",children:"✖"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>f(-1),className:"px-4 py-2 bg-gray-300 rounded",children:"⬅"}),e.jsx("img",{src:r[b],className:"max-w-[70%] max-h-[90vh] object-contain mx-4",alt:"Zoomed Aadhar"}),e.jsx("button",{onClick:()=>f(1),className:"px-4 py-2 bg-gray-300 rounded",children:"➡"})]}),e.jsxs("div",{className:"flex flex-col gap-4 w-1/3 p-4",children:[e.jsx("input",{type:"text",className:"border p-2 w-full",placeholder:"Aadhar Number",value:h,onChange:a=>S(a.target.value)}),e.jsx("input",{type:"text",className:"border p-2 w-full",placeholder:"Permanent Address",value:N,onChange:a=>p(a.target.value)}),e.jsx("button",{onClick:m,className:"bg-blue-500 text-white px-4 py-2 rounded",disabled:y,children:y?"Saving...":"Save"})]})]})}),g&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-[60]",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg relative",children:[e.jsx("button",{onClick:()=>L(!1),className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full",children:"✖"}),e.jsx("img",{src:t.profilePic,className:"max-w-full max-h-[90vh] object-contain",alt:"Zoomed Profile"})]})})]})},le=()=>{const[t,D]=i.useState([]),[I,w]=i.useState(null),[b,P]=i.useState(""),[g,L]=i.useState(""),N=X(),[p,h]=i.useState(1),[S,y]=i.useState(1),[x,z]=i.useState(10),U=async(s=1,r=10)=>{var m,o;try{const n=await u.get(`${j}/auth/getAllUser`,{params:{page:s,limit:r}}),{users:f,totalPages:C,totalUsers:B,currentPage:k}=n.data.data,v=f.filter(Z=>Z.isAdminApproved===!0);D(v),y(C),h(k)}catch(n){console.error("Error:",n.message),c(((o=(m=n==null?void 0:n.response)==null?void 0:m.data)==null?void 0:o.message)||"Something went wrong")}};i.useEffect(()=>{U(p,x)},[p,x]);const A=async s=>{c.info(e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to delete?"}),e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>F(s),children:"Yes"}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:c.dismiss,children:"No"})]})]}),{autoClose:!0,closeOnClick:!0})},F=async s=>{var r,m,o;c.dismiss();try{const n=await u.delete(`${j}/auth/deleteUser`,{headers:{"Content-Type":"application/json"},data:{id:s}});n.status===200&&(c((r=n==null?void 0:n.data)==null?void 0:r.message),U())}catch(n){console.error("Error:",n.message),c((o=(m=n==null?void 0:n.response)==null?void 0:m.data)==null?void 0:o.message)}};i.useEffect(()=>{U()},[]),t.filter(s=>s.name.toLowerCase().includes(b.toLowerCase())||s.email.toLowerCase().includes(b.toLowerCase())||s.phone.includes(b)||s.businessCategory.some(r=>r.toLowerCase().includes(b.toLowerCase()))).sort((s,r)=>g==="A-Z"?r.name.localeCompare(s.name):g==="Z-A"?s.name.localeCompare(r.name):g==="oldest-newest"?new Date(r.createdAt)-new Date(s.createdAt):g==="newest-oldest"?new Date(s.createdAt)-new Date(r.createdAt):0);const $=async s=>{var r,m;if(console.log(s,"referredById"),!!s)try{const o=await u.get(`${j}/auth/getUserById/${s}`);w(o.data.user)}catch(o){console.error("Error fetching referred user:",o.message),c(((m=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:m.message)||"Failed to fetch referred user details")}};return e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsx(se,{}),e.jsxs("div",{className:"my-32",children:[e.jsx("section",{children:e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"card bg-base-100 shadow-xl mt-5",children:[e.jsx("div",{className:"card-header text-xl font-bold py-3",children:"All Users"}),e.jsxs("div",{className:"p-3",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by Name, Email, Phone or Buisness Category",value:b,onChange:s=>P(s.target.value)}),e.jsxs("select",{className:"form-select mt-2",value:g,onChange:s=>L(s.target.value),children:[e.jsx("option",{value:"",children:"Sort By"}),e.jsx("option",{value:"A-Z",children:"A-Z"}),e.jsx("option",{value:"Z-A",children:"Z-A"}),e.jsx("option",{value:"oldest-newest",children:"Oldest-Newest"}),e.jsx("option",{value:"newest-oldest",children:"Newest-Oldest"})]})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table table-bordered border",children:[e.jsx("thead",{className:"text-bold text-[15px] text-black bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{children:"SrNo"}),e.jsx("th",{children:"DateTime"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"BuisnessCategory"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Referred By"}),e.jsx("th",{children:"UserStatus"}),e.jsx("th",{children:"Payment Status"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Remarks"})]})}),e.jsx("tbody",{children:t.map((s,r)=>{var m,o,n,f,C,B,k;return e.jsxs("tr",{children:[e.jsx("th",{children:(p-1)*x+r+1}),e.jsx("td",{className:"text-sm",children:new Date(s.createdAt).toLocaleString()}),e.jsx("td",{className:"text-sm",children:s.name}),e.jsx("td",{className:"text-sm capitalize",children:s.businessCategory[0]}),e.jsx("td",{className:"text-sm",children:s.phone}),e.jsx("td",{className:"text-sm",children:`${(m=s==null?void 0:s.address)==null?void 0:m.area}, ${(o=s==null?void 0:s.address)==null?void 0:o.city}, ${(n=s==null?void 0:s.address)==null?void 0:n.state}, ${(f=s==null?void 0:s.address)==null?void 0:f.country}, ${(C=s==null?void 0:s.address)==null?void 0:C.pincode}`}),e.jsx("td",{className:"text-sm",children:e.jsx("button",{className:"btn btn-light border border-gray-300 btn-sm",onClick:()=>{var v;return $((v=s==null?void 0:s.referredBy[0])==null?void 0:v._id)},children:((B=s==null?void 0:s.referredBy)==null?void 0:B.length)>0?(k=s==null?void 0:s.referredBy[0])==null?void 0:k.name:"N/A"})}),e.jsxs("td",{className:"text-sm",children:[" ",(s==null?void 0:s.userstatus)==="available"?e.jsx("span",{className:"btn btn-sm btn-success",children:"available"}):e.jsx("span",{className:"btn btn-sm btn-danger",children:"unavailable"})]}),e.jsx("td",{className:"text-sm",children:s.paymentVerified?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-sm",children:e.jsxs("span",{className:"text-white flex items-center gap-2",children:["Payment ",e.jsx(te,{})]})}),e.jsx("button",{})]}):e.jsx("button",{className:"btn btn-danger btn-sm",children:e.jsxs("span",{className:"text-white flex items-center gap-2",children:["Payment"," ",e.jsx(ae,{size:17,className:""})]})})}),e.jsxs("td",{className:"d-flex",children:[e.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>w(s),children:"Details"}),e.jsx("button",{className:"btn btn-danger btn-sm ml-2",onClick:()=>A(s._id),children:"Delete"}),e.jsx("button",{className:"btn btn-warning text-white btn-sm ml-2",onClick:()=>N("/admin/editUser",{state:s}),children:"Edit"})]}),e.jsx("td",{className:"text-sm",children:e.jsx(re,{to:"/admin/users/addremark",state:{userId:s._id},className:"btn btn-sm btn-info",children:"Add Remarks"})})]},s._id)})})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4 px-4",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>h(s=>Math.max(s-1,1)),disabled:p===1,children:"⬅️ Prev"}),e.jsxs("span",{className:"text-sm font-semibold",children:["Page ",p," of ",S]}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>h(s=>Math.min(s+1,S)),disabled:p===S,children:"Next ➡️"})]})]})})}),I&&e.jsx(ne,{user:I,setSelectedUser:w,onClose:()=>w(null)})]})]})};export{le as default};
