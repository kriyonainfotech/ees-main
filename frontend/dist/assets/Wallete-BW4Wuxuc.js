import{r as a,U as E,j as e,A as C,e as W,P as k,i as I,c as f,B as n}from"./index-C8xOUKJO.js";const j="https://ees121.com",U=({onClose:t,onSubmit:d})=>{const[x,y]=a.useState(""),[o,g]=a.useState(""),b=[121,200,300,400,500],u=async()=>{if(!o||o<120){n.error("Minimum withdrawal amount is ₹120");return}const s={upiId:x,amount:o};try{const c=await f.post(`${j}/withdrawal/request`,s,{withCredentials:!0});c.status===200?(n.success("Withdrawal request submitted successfully!"),d(s),t()):n.error(c.message||"Failed to submit request")}catch(c){console.error("Error:",c),n.error("Something went wrong!")}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 p-5 z-50",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-lg shadow-lg p-4 relative",children:[e.jsx("button",{className:"absolute top-2 right-4 bg-gray-200 hover:bg-gray-300 text-black rounded-full w-8 h-8 flex items-center justify-center",onClick:t,children:"✕"}),e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Withdraw Funds"}),e.jsxs("label",{className:"block mb-2",children:["Enter UPI ID ",e.jsx("span",{className:"text-gray-500 text-sm",children:"(optional)"})]}),e.jsx("input",{type:"text",className:"w-full border p-2 mb-4",placeholder:"Enter UPI ID",value:x,onChange:s=>y(s.target.value)}),e.jsx("h3",{className:"mb-2 text-lg",children:"Select Withdrawal Amount"}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-3",children:b.map(s=>e.jsxs("button",{className:`px-4 py-2 rounded-md border ${o===s?"bg-blue-600 text-white":"bg-gray-200"}`,onClick:()=>g(s),children:["₹",s]},s))}),e.jsx("input",{type:"number",value:o,onChange:s=>g(s.target.value),className:"border rounded-md p-2 w-full"}),e.jsx("button",{className:"mt-4 w-full p-2 bg-green-600 text-white rounded",onClick:u,children:"Submit Request"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2 mt-5",children:[e.jsx("span",{children:"*"})," Note : If you prefer to receive payments via UPI, enter your UPI ID here.",e.jsx("strong",{children:"Leave empty if you want to receive payments in your bank account."})]})]})})},A=()=>{const{user:t}=a.useContext(E);console.log(t,"user");const[d,x]=a.useState(0),[y,o]=a.useState([]),[g,b]=a.useState(0),[u,s]=a.useState(!0),[c,h]=a.useState(""),[v,p]=a.useState(!1);a.useEffect(()=>{(async()=>{var i,w;if(!(t!=null&&t._id)){h("User is not authenticated"),s(!1);return}try{const l=await f.get(`${j}/referal/getUserWalletBalance/${t._id}`);console.log(l.data,"wallete"),x(l.data.walletBalance),o(l.data.earningsHistory||[])}catch(l){h(((w=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:w.message)||"Error fetching wallet balance")}finally{s(!1)}})()},[t==null?void 0:t._id]);const S=()=>{var r,i;if(!(t!=null&&t.ekyc)){n.error("Submit your ekyc details first!!");return}if(((r=t==null?void 0:t.ekyc)==null?void 0:r.status)==="pending"){n.warning("Your KYC details are waiting for admin's approval.");return}if(((i=t==null?void 0:t.ekyc)==null?void 0:i.status)!=="approved"){n.error("Your KYC is not approved yet. Please complete your KYC.");return}if(d<120){n.warning("Minimum withdrawal amount is ₹120");return}p(!0)};return a.useEffect(()=>{let r=!0;const i=new AbortController;return(async()=>{var l,N;if(t!=null&&t._id)try{s(!0);const m=await f.get(`${j}/referal/earnings/${t._id}`,{signal:i.signal});r&&m.status===200&&(b(m.data.earnings),h(null))}catch(m){r&&(console.error("[ERROR] Failed to fetch earnings:",m),f.isCancel(m)||(h(((N=(l=m.response)==null?void 0:l.data)==null?void 0:N.message)||"Failed to fetch earnings"),n.error("Error loading earnings data.")))}finally{r&&s(!1)}})(),()=>{r=!1,i.abort()}},[t==null?void 0:t._id]),e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsx(W,{}),e.jsx(k,{}),e.jsx("div",{className:"mt-40",children:e.jsx("div",{className:"container",children:e.jsx("section",{className:"",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"wallete px-0",children:e.jsx("div",{className:"w-full flex flex-col items-center justify-center p-6 my-5 bg-red-100 rounded-lg shadow-md",children:u?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"spinner-border text-danger",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})})}):c?e.jsx("div",{className:"w-full text-center p-3 bg-red-200 text-red-800 rounded-lg",children:c}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full flex justify-end mb-4",children:e.jsx("button",{className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md disabled:bg-gray-400",onClick:S,children:u?"Loading...":`Withdraw ₹${d>=120?d:0}`})}),v&&e.jsx(U,{onClose:()=>p(!1),onSubmit:r=>{console.log("Withdrawal Request Data:",r),p(!1)}}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 w-full",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total Wallet Balance"}),u?e.jsx("div",{className:"animate-spin h-6 w-6 border-t-4 border-blue-500 rounded-full mt-2"}):e.jsxs("h3",{className:"text-3xl font-bold text-blue-600",children:["₹",d||0]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total Earnings"}),u?e.jsx("div",{className:"animate-spin h-6 w-6 border-t-4 border-green-500 rounded-full mt-2"}):e.jsxs("h3",{className:"text-3xl font-bold text-green-600",children:["₹",g||0]})]})]})]})})})})})})}),e.jsx(I,{})]})},$=a.memo(A);export{$ as default};
