import{r as s,F as O,U as B,u as k,j as e,m as z,L as M,c as $,B as N,d as T,A as V,e as D,P as J,v as Y,i as G}from"./index-CcKrehrl.js";import{s as H,a as W}from"./startSilver-5oWuoMuE.js";const L="https://ees121.com",K=({Usersdata:t,token:f})=>{var l,h,i,C,y;console.log(t,"Usersdata"),s.useContext(O),s.useContext(B);const[m,w]=s.useState(null),[j,c]=s.useState(!1),[I,S]=s.useState([]),[x,d]=s.useState("I NEED YOUR SERVICE"),[b,E]=s.useState(!1),g=k(),R=(a=[],p=10)=>{const u=a.length>0?a.reduce((o,n)=>o+n,0)/a.length:0;return Array.from({length:p},(o,n)=>e.jsx("img",{src:n<u?H:W,alt:n<u?"Filled Star":"Empty Star",width:15},n))};s.useEffect(()=>{(async()=>{var p,u,o;c(!0);try{const n=await $.get(`${L}/request/getUserRequests`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`}});if(console.log(n.data.requests),n.status===200&&n.data.requests){S(n.data.requests);const P=n.data.requests.sended_requests||[],X=n.data.requests.received_requests||[],_=P.some(r=>r.status==="pending"||r.status==="accepted");let v=null;const A=P.filter(r=>{var F;return((F=r.user)==null?void 0:F._id)===(t==null?void 0:t._id)});A.some(r=>r.status==="pending")?v="pending":A.some(r=>r.status==="accepted")?v="accepted":A.some(r=>r.status==="completed"||r.status==="rated")&&(v="completed"),w(v),E(_),console.log("Updated Request Status:",v),console.log("Global Pending/Accepted Request Exists:",_)}}catch(n){console.error("Error fetching requests:",((p=n.response)==null?void 0:p.data)||n.message),N((o=(u=n==null?void 0:n.response)==null?void 0:u.data)==null?void 0:o.message)}finally{c(!1)}})()},[t,f]);const q=async(a,p="I NEED YOUR SERVICE")=>{var u;if((t==null?void 0:t.userstatus)==="unavailable"){N("User is unavailable");return}c(!0);try{const o=await $.post(`${L}/request/sentRequest`,{receiverId:t._id,message:p},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`}});o.status===200?(w("pending"),N(o.data.message||"Request Sent Successfully!"),g("/work"),setTimeout(()=>{window.location.reload()},500)):N.error(o.data.message)}catch(o){console.error("Error sending request:",((u=o.response)==null?void 0:u.data)||o.message),N.error(o.response.data.message)}finally{c(!1)}};return t?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"col-12 col-md-6 col-xl-4 p-2 cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col border overflow-hidden rounded-lg shadow-lg relative bg-white w-full h-full",children:[e.jsxs("div",{className:"relative p-2",children:[e.jsx("div",{className:"flex justify-center items-center w-full h-70 border rounded-md overflow-hidden bg-gray-100",children:e.jsx("img",{src:(t==null?void 0:t.profilePic)||z,alt:"User Profile",className:"w-full h-full object-cover object-center"})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("span",{className:`px-3 py-1 shadow-md rounded-full text-xs font-medium 
          ${(t==null?void 0:t.userstatus)==="available"?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:t==null?void 0:t.userstatus})})]}),e.jsxs("div",{className:"p-4 text-start",children:[e.jsxs("div",{className:"flex justify-between items-center pb-3",children:[e.jsx("h4",{className:"font-bold text-lg capitalize",children:t==null?void 0:t.name}),e.jsx("h6",{className:"font-medium text-gray-700 py-1 capitalize",children:t==null?void 0:t.businessCategory.join(", ")})]}),e.jsxs("p",{className:"text-gray-500 text-sm",children:[`${(l=t==null?void 0:t.address)==null?void 0:l.area}, ${(h=t==null?void 0:t.address)==null?void 0:h.city}, ${(i=t==null?void 0:t.address)==null?void 0:i.state}, ${(C=t==null?void 0:t.address)==null?void 0:C.country}`," ",e.jsx("br",{}),`${(y=t==null?void 0:t.address)==null?void 0:y.pincode}`]}),e.jsxs("div",{className:"py-2 flex justify-start items-center",children:[e.jsxs("p",{className:"text-xs font-medium flex justify-center items-center",children:["User : ",e.jsx("span",{className:"flex ",children:R(t.userRatings.map(a=>a.rating),10)})]}),e.jsxs("span",{className:"ml-2 text-sm font-medium",children:[" ",t.userAverageRating>0?t.userAverageRating.toFixed(1):"0.0"]})]}),e.jsxs("div",{className:"py-2 flex justify-start items-center",children:[e.jsxs("p",{className:"text-xs font-medium flex justify-center items-center",children:["Provider :",e.jsx("span",{className:"flex ",children:R(t.providerRatings.map(a=>a.rating),10)})]}),e.jsxs("span",{className:"ml-2 text-sm font-medium",children:[" ",t.providerAverageRating>0?t.providerAverageRating.toFixed(1):"0.0"]})]}),e.jsx("div",{className:"mt-3",children:m==="pending"||m==="accepted"?e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(M,{href:`tel:${t==null?void 0:t.phone}`,className:"bg-green-600 text-white font-semibold px-4 py-2 rounded-md shadow-md hover:bg-green-700 w-1/2 text-center",children:"Contact Now"}),e.jsx("button",{className:"bg-warning text-white font-semibold px-4 py-2 rounded-md shadow-md hover:bg-orange-700 transition duration-200 w-1/2",onClick:()=>g("/work"),children:"View Request"})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("button",{className:`font-semibold px-4 py-2 w-full rounded-md shadow-md transition duration-200 ${b?"bg-gray-400 cursor-not-allowed text-white":"bg-blue-600 text-white hover:bg-blue-700"}`,"data-bs-toggle":"modal","data-bs-target":`#modal-${t._id}`,disabled:b,children:"Send Request"}),b&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:"⚠️ You already have a request in progress."})]})})]})]}),e.jsx("div",{className:"modal fade",id:`modal-${t._id}`,tabIndex:-1,"aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content rounded-lg shadow-lg",children:[e.jsxs("div",{className:"modal-header border-b",children:[e.jsxs("h5",{className:"text-xl font-semibold",children:["Send Request to ",t.name]}),e.jsx("button",{type:"button",className:"btn-close text-white p-3","data-bs-dismiss":"modal"})]}),e.jsxs("div",{className:"modal-body py-4",children:[e.jsx("h4",{className:"text-lg capitalize font-medium mb-2",children:t.businessCategory.join(", ")}),e.jsx("textarea",{className:"w-full p-3 border rounded-md focus:outline-none focus:ring focus:ring-blue-300 resize-none",rows:"1",value:x,onChange:a=>d(a.target.value),placeholder:"Write your message..."})]}),e.jsxs("div",{className:"modal-footer border-t pt-3 flex justify-end",children:[e.jsx("button",{type:"button",className:"bg-gray-500 text-white px-4 py-2 rounded-md","data-bs-dismiss":"modal",children:"Close"}),e.jsx("button",{type:"button",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200 ml-2",onClick:()=>q(t._id),disabled:j,children:j?e.jsx("span",{className:"spinner-border spinner-border-sm text-white"}):"Send Request"})]})]})})})]})}):e.jsx("p",{children:"Loading user data..."})},Q="https://ees121.com",ee=()=>{var q;const{user:t}=s.useContext(B),f=s.useMemo(()=>JSON.parse(localStorage.getItem("token")),[]),m=T(),[w,j]=s.useState(!1),[c,I]=s.useState(()=>localStorage.getItem("selectedCategory")||null),[S,x]=s.useState([]),[d,b]=s.useState(()=>t||JSON.parse(localStorage.getItem("loggedInUser"))||null),[E,g]=s.useState(""),R=async(l,h)=>{if(!(!l||!h)){j(!0);try{const i=await $.post(`${Q}/auth/getUsersByBCategory`,{category:l,city:h,isAdminApproved:!0,paymentVerified:!0,sortByRating:"desc"},{headers:{"Content-Type":"application/json"},withCredentials:!0});if(console.log(i.data,"response"),i.data.success){const C=Array.from(new Map(i.data.users.map(y=>[y._id,y])).values());x(C),g(i.data.message)}else console.error("Error fetching data:",i.data.message),x([]),g(i.data.message)}catch(i){console.error("Error fetching data:",i.message||i),x([]),g("Failed to fetch providers. Please try again.")}finally{j(!1)}}};return s.useEffect(()=>{window.scrollTo(0,0)},[]),s.useEffect(()=>{if(m.state){const l=m.state;I(l),localStorage.setItem("selectedCategory",l)}},[m.state]),s.useEffect(()=>{var l;c&&((l=d==null?void 0:d.address)!=null&&l.city)&&R(c,d.address.city)},[c,(q=d==null?void 0:d.address)==null?void 0:q.city]),s.useEffect(()=>()=>{x([])},[]),s.useEffect(()=>{t&&(b(t),localStorage.setItem("loggedInUser",JSON.stringify(t)))},[t]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"min-h-screen d-flex flex-column",children:[e.jsx(V,{}),e.jsx(D,{}),e.jsx(J,{}),e.jsx("main",{className:"flex-grow",children:e.jsx("section",{className:" mt-28",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"d-flex",children:e.jsx("h3",{className:"py-4 text-capitalize",children:c})}),e.jsx("div",{className:"col-12 d-flex flex-wrap px-0",children:w?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",width:"100vw"},children:e.jsx(Y,{color:"#00BFFF",height:50,width:50})}):S.length>0?S.map((l,h)=>e.jsx(K,{Usersdata:l,token:f},l._id)):e.jsx("h6",{className:"pt-3 px-3",children:E})})]})})})}),e.jsx(G,{})]})})};export{ee as default};
