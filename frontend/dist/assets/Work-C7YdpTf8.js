import{r as l,j as e,f as E,w as U,c as S,B as r,U as B,A as z,e as _,P as D,L,k as M}from"./index-CL1QAMa8.js";import{s as O,a as T}from"./startSilver-5oWuoMuE.js";import{f as J,S as W}from"./Senedrequest-D2f7cBl4.js";import{$ as Y}from"./module-xFKqGg3w.js";import{k as F}from"./index-zqr3JlAy.js";const A="https://ees121.com",q=({receivedRequest:d,setReceivedRequest:w,user:u})=>{console.log(u,"useewr"),console.log(d,"receivedRequest");const[g,j]=l.useState(null),[i,k]=l.useState(null),[v,h]=l.useState(0),[y,C]=l.useState(""),N=JSON.parse(localStorage.getItem("token")),b=async(t,n,s,o)=>{console.log(t,s,n,"id, status, requestId");try{const a=s==="cancelled"?"cancelRequest":"updateRequestStatus",m=await S.post(`${A}/request/${a}`,{userId:t,requestId:n,status:s},{headers:{Authorization:`Bearer ${N}`}});console.log(m,"response"),m.status===200?(r.success(`Request ${s}`),k(s),w(x=>x.map(f=>f.requestId===n?{...f,status:s}:f))):r.error("Failed to update request")}catch(a){console.log(a,"error"),r.error("Failed to update request")}},$=t=>{j(t)},c=()=>{j(null),h(0)},I=async(t,n,s,o)=>{if(console.log(t,n,s,o,"requestId, receiverId, ratingValue, comment"),!t||!n||!s){console.error("Missing rating data");return}try{const a=await S.post(`${A}/user/rate`,{requestId:t,receiverId:n,ratingValue:s,comment:o},{withCredentials:!0,headers:{Authorization:`Bearer ${N}`}});console.log("Rating submitted successfully:",a.data),a.status===200?(r.success(a.data.message||"Rating submitted successfully"),c()):r.error("Failed to submit rating")}catch(a){console.log("Error submitting rating:",a||a.message),r.error("Failed to submit rating")}},p=(t=0,n=10,s=!1)=>Array.from({length:n},(o,a)=>e.jsx("img",{src:a<t?O:T,alt:a<t?"Filled Star":"Empty Star",width:16,className:`cursor-pointer ${s?"hover:opacity-80":""}`,onClick:s?()=>h(a+1):void 0},a)),R=t=>{const n=u==null?void 0:u._id;if(!n){r.error("User not found!");return}r.info(e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to cancel this request?"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-2",children:[e.jsx("button",{className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700",onClick:async()=>{var s,o;r.dismiss();try{const{data:a}=await S.delete(`${A}/request/deleteRequest`,{data:{requestId:t,userId:n}});a.success?(r.success("Request deleted successfully!"),setTimeout(()=>{window.location.reload()},4e3)):r.error(a.message||"Failed to delete request.")}catch(a){console.error("Error deleting request:",a),r.error(((o=(s=a.response)==null?void 0:s.data)==null?void 0:o.message)||"An error occurred while deleting the request.")}},children:"Yes"}),e.jsx("button",{className:"px-3 py-1 bg-gray-400 text-white rounded-md hover:bg-gray-500",onClick:()=>r.dismiss(),children:"No"})]})]}),{autoClose:!1,closeOnClick:!1})};return e.jsxs("div",{className:"mt-0",children:[e.jsx("section",{children:e.jsx("div",{className:"grid  grid-cols-2 xl:grid-cols-4 gap-4 mt-4",children:d!=null&&d.length?d.map((t,n)=>{var s,o,a,m,x;return e.jsxs("div",{title:t.status==="cancelled"?"Sender has cancelled the request.":t.status==="rejected"?"Receiver has rejected the request.":t.status==="completed"?"Request completed, rate the user.":t.status==="accepted"?"Request accepted, contact the user.":"",className:"bg-white rounded-xl border  overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{className:"w-full h-[250px] md:h-[350px] object-cover object-top",src:t.profilePic||E,alt:"Profile"}),e.jsx("span",{className:`absolute top-4 right-4 py-2 px-3 text-xs rounded-full font-semibold text-white ${t.status==="accepted"?"bg-blue-600":t.status==="completed"?"bg-green-600":"bg-yellow-500"}`,children:t.status||"Pending"})]}),e.jsxs("div",{className:"p-3 sm:w-full",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 sm:w-full block",children:t.name||"Unknown User"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mt-2",children:[e.jsx("p",{className:"text-orange-600 text-sm font-medium capitalize",children:((s=t.businessCategory)==null?void 0:s.join(", "))||"N/A"}),e.jsx("p",{className:"text-xs text-gray-500",children:J(new Date(t.date),"PPpp")})]}),e.jsxs("div",{className:"flex flex-wrap items-center mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-800 text-sm  ",children:"Provider Rating:"}),e.jsx("div",{className:"flex gap-1 overflow-auto mt-1",children:p(((o=t==null?void 0:t.providerRatingbySender)==null?void 0:o.value)||0,10)}),e.jsx("span",{className:"text-gray-700 block mt-1 ps-2",children:((a=t==null?void 0:t.providerRatingbySender)==null?void 0:a.value)||0})]}),e.jsxs("div",{className:"flex flex-wrap items-center mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-800 text-sm  ",children:"User Rating:"}),e.jsx("div",{className:"flex gap-1 overflow-auto mt-1",children:p(((m=t==null?void 0:t.userRatingbyprovider)==null?void 0:m.value)||0,10)}),e.jsx("span",{className:"text-gray-700 block mt-1 ps-2",children:((x=t==null?void 0:t.userRatingbyprovider)==null?void 0:x.value)||0})]}),e.jsxs("div",{className:"mt-4 flex flex-col md:flex-row gap-2",children:[t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"p-2 text-sm w-full md:flex-1 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",onClick:()=>b(t.senderId,t.requestId,"accepted"),children:"Accept"}),e.jsx("button",{className:"p-2 text-sm w-full md:flex-1 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",onClick:()=>b(t.senderId,t.requestId,"rejected"),children:"Reject"})]}),t.status==="accepted"&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`tel:${t.phone}`,className:"w-full sm:flex-1 flex items-center justify-center gap-2 p-2 text-sm text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(U,{})," Contact Now"]}),e.jsx("button",{className:"w-full sm:w-auto p-2 bg-blue-600 text-sm text-white rounded-lg hover:bg-blue-700 transition",onClick:()=>b(t.senderId,t.requestId,"completed"),children:"Completed"})]}),t.status==="completed"&&e.jsx("button",{className:"p-2 text-sm w-full bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition",onClick:()=>$(t),children:"Rate User"}),t.status==="rated"&&e.jsx("button",{className:"w-full sm:w-auto p-2 bg-gray-600 text-white rounded-lg hover:bg-red-900 transition",onClick:()=>R(t.requestId),children:"Remove"})]})]})]},n)}):e.jsxs("div",{className:"col-span-12 text-center py-12",children:[e.jsx("h5",{children:"No Requests Found"}),e.jsx("p",{className:"text-gray-500",children:"Your received requests will appear here."})]})})}),g&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Rate ",g.name]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between pb-2",children:[e.jsx("div",{className:"flex justify-center",children:p(v,10,!0)}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-md p-2 mb-4 resize-none",rows:3,placeholder:"Write a comment ...",value:y,onChange:t=>C(t.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"p-2 text-sm bg-gray-400 text-white rounded-lg",onClick:c,children:"Cancel"}),e.jsx("button",{className:"p-2 text-sm bg-blue-600 text-white rounded-lg",onClick:()=>I(g.requestId,g.senderId,v,y),children:"Submit"})]})]})})]})},P="https://ees121.com",Z=()=>{const d=JSON.parse(localStorage.getItem("token"))||null,[w,u]=l.useState([]),[g,j]=l.useState([]),[i,k]=l.useState(localStorage.getItem("currentRequest")||"Sended Request"),[v,h]=l.useState(!0),[y,C]=l.useState(!1),{user:N}=l.useContext(B);l.useEffect(()=>{setTimeout(()=>C(!0),50)},[]),console.log(w,"receivedRequest"),l.useEffect(()=>{localStorage.setItem("currentRequest",i)},[i]);const b=[{id:1,name:"Sended Request"},{id:2,name:"Received Request"}],$=l.useCallback(async c=>{var p,R,t,n;if(!d){console.warn("⚠️ No authentication token found."),F.error("Authentication required!"),h(!1);return}console.log("Fetching requests...",c),h(!0);let I=c==="Sended Request"?`${P}/request/getSentRequests`:`${P}/request/getReceivedRequests`;try{const s=await S.get(I,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}});if(console.log(s.data,"response----------------------------.data"),s.status===200&&s.data){const o={pending:1,accepted:2,completed:3,rated:4,rejected:5},a=((p=c==="Sended Request"?s.data.sendedRequests:s.data.receivedRequests)==null?void 0:p.sort((m,x)=>{const f=(o[m.status]||99)-(o[x.status]||99);return f!==0?f:new Date(x.date)-new Date(m.date)}))||[];c==="Sended Request"?j(a):u(a)}else F.error(((R=s==null?void 0:s.data)==null?void 0:R.message)||"Error fetching requests")}catch(s){console.log(s,"error"),F.error(((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||"Server error")}finally{h(!1)}},[d,i]);return l.useEffect(()=>{$(i)},[i]),y?e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx(_,{}),e.jsx(D,{}),e.jsx("div",{className:"mt-40",children:e.jsx("section",{className:"bg-gray-50 py-5",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 d-flex gap-3  ",style:{position:"sticky",top:"0",zIndex:10,padding:"20px 10px"},children:b.map(c=>e.jsx("div",{className:"receivReqBtn",children:e.jsx(L,{className:`btn rounded-lg ${i===c.name?"btn-success text-white":"bg-none border-black text-black"}`,onClick:()=>k(c.name),children:c.name})},c.id))}),e.jsx("div",{children:v?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"300px"},children:e.jsx(Y,{color:"#00BFFF",height:50,width:50})}):i==="Received Request"?e.jsx(q,{receivedRequest:w,setReceivedRequest:u,user:N}):e.jsx(W,{sendedRequest:g,setSendedRequest:j})})]})})})}),e.jsx(M,{})]}):null};export{Z as default};
