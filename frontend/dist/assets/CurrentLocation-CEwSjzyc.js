import{r as i,B as t,j as s,E as k,c as N}from"./index-XkJsnXAT.js";const C="https://ees121.com",A=({user:n})=>{const[e,d]=i.useState((n==null?void 0:n.address)||{}),[a,c]=i.useState(!1),[u,p]=i.useState(!1);i.useEffect(()=>{a&&f()},[a]);const f=async()=>{if(navigator.permissions)try{(await navigator.permissions.query({name:"geolocation"})).state==="denied"&&(t.error("Location permission denied. Please enable it in browser settings."),c(!1))}catch(o){console.error("Error checking permission:",o)}},h=()=>{if(!navigator.geolocation){t.error("Geolocation is not supported by this browser.");return}navigator.geolocation.getCurrentPosition(async o=>{const{latitude:r,longitude:m}=o.coords;console.log("Latitude:",r,"Longitude:",m);try{const l=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${r}&lon=${m}&format=json&zoom=18&addressdetails=1`)).json();if(l.address){const{suburb:x,village:b,city:j,town:E,state_district:L,state:w,country:v,postcode:P}=l.address;console.log("Fetched Address:",l.address),d({area:x||b||E||j||"",city:L||"",state:w||"",country:v||"",pincode:P||""}),t.success("Location fetched successfully!")}else t.error("Failed to fetch location. Try again.")}catch(g){console.error("Error fetching location:",g),t.error("Failed to fetch location details.")}},o=>{console.error("Geolocation Error:",o),t.error("Please allow location access.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},y=async()=>{if(!e.area||!e.city||!e.state||!e.country||!e.pincode){t.error("Please fetch your current location first!");return}p(!0);const o=JSON.parse(localStorage.getItem("token"));try{(await N.post(`${C}/auth/updateProfile`,{address:e},{headers:{Authorization:`Bearer ${o}`},withCredentials:!0})).status===200?(c(!1),t.success("Location updated successfully!"),d(e)):t.error("Failed to update location")}catch(r){console.error("Error updating profile:",r),t.error("Failed to update profile. Please try again.")}finally{p(!1)}};return s.jsxs("div",{children:[s.jsxs("div",{className:"d-flex gap-2",children:[s.jsxs("p",{className:"text-gray mb-0",children:[e.area," ",e.city," ",e.state," ",e.country," ",e.pincode]}),s.jsx(k,{className:"md:text-md cursor-pointer",onClick:()=>c(!a)})]}),a&&s.jsxs("div",{className:"d-flex align-items-center gap-3 p-3 border rounded bg-light mt-2",children:[s.jsx("button",{onClick:h,className:"btn btn-outline-primary",children:"Get Location"}),s.jsxs("p",{className:"mb-0 flex-grow-1 text-center",children:[e.area," ",e.city," ",e.state," ",e.country," ",e.pincode]}),s.jsx("button",{onClick:y,className:"btn btn-primary",disabled:u,children:u?"Updating...":"Update"})]})]})};export{A as C};
