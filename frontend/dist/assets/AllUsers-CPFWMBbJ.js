import{r as m,u as X,j as e,q as ee,s as se,S as te,K as ae,L as re,c as g,B as c}from"./index-krimXHuz.js";const p="https://ees121.com",de=({user:t,onClose:k,onApprove:D,setSelectedUser:f})=>{var z,F,R,T,_,Y,K,H,O,V,M,q,J;const[h,w]=m.useState(null),[b,v]=m.useState(!1),[y,P]=m.useState(t.permanentAddress||""),[N,S]=m.useState(t.aadharNumber||""),[j,x]=m.useState(!1),[L,I]=m.useState(t.profilePic),[u,Z]=m.useState(t._id),s=(t==null?void 0:t.paymentHistory)||[],d=s.length>0?(z=s[0])==null?void 0:z.status:"N/A",r=[t.frontAadhar,t.backAadhar];if(!t)return null;const o=async()=>{var a,n,C;console.log(y,N,u,"permanentAddress, aadharNumber");try{x(!0);const l=await g.put(`${p}/auth/updateUserAddressAndAadhar`,{permanentAddress:y,aadharNumber:N,userId:u});console.log(l.data),l.status===200&&c.success((a=l==null?void 0:l.data)==null?void 0:a.message)}catch(l){console.log("Error updating user details:",l),c.error(((C=(n=l==null?void 0:l.response)==null?void 0:n.data)==null?void 0:C.message)||"Failed to update user details")}finally{x(!1)}},i=a=>{w(a)},U=()=>{w(null)},A=a=>{w(n=>(n+a+r.length)%r.length)},$=()=>{c.info(e.jsxs("div",{children:["Are you sure you want to reset eKYC? This action will permanently remove all KYC related data.",e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsx("button",{className:"bg-red-600 text-white px-3 py-1 rounded-md",onClick:B,children:"Yes"}),e.jsx("button",{className:"bg-gray-400 text-white px-3 py-1 rounded-md",onClick:()=>c.dismiss(),children:"No"})]})]}),{autoClose:!1,closeOnClick:!1})},B=async()=>{var a,n,C;c.dismiss();try{x(!0);const l=await g.post(`${p}/auth/reset-ekyc`,{userId:u});if(l.status===200){c.success((a=l==null?void 0:l.data)==null?void 0:a.message);const W={...t,ekyc:null,frontAadhar:null,backAadhar:null};f(W),k()}}catch(l){console.error("Error deleting Aadhar:",l),c.error(((C=(n=l==null?void 0:l.response)==null?void 0:n.data)==null?void 0:C.message)||"Failed to delete Aadhar images")}finally{x(!1)}},E=async()=>{try{x(!0);const a=await fetch(`${p}/auth/update-profile-pic`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t._id,profilePic:"https://res.cloudinary.com/dcfm0aowt/image/upload/v1739604108/user/phnbhd4onynoetzdxqjp.jpg"})}),n=await a.json();console.log(n,"response of allow reset"),a.ok?(I(n.profilePic),c.success("Profile picture updated successfully!")):c.error(n.message||"Failed to update profile picture.")}catch(a){console.log("API Error:",a),c.error("Something went wrong while updating profile picture.")}finally{x(!1)}},G=async a=>{try{const n=await g.post(`${p}/payment/capture-payment`,{paymentId:a,userId:u});console.log(n,"data"),alert(n.data.message)}catch{alert("Error capturing payment")}},Q=async()=>{try{const a=await g.post(`${p}/payment/verify-capture-payment`,{userId:t._id});a.data.success?c("Payment verified successfully!"):alert("Error: "+a.data.message)}catch(a){console.error("Error verifying payment:",a),c("Something went wrong!")}};return e.jsxs("div",{className:"modal-overlay fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:[e.jsxs("div",{className:"modal-content bg-white p-2 rounded shadow-lg w-full sm:w-3/4 md:w-1/2 lg:w-1/3 max-w-4xl h-[80vh] overflow-hidden",children:[e.jsx("h2",{className:"text-xl font-bold py-3 text-center border",children:"User Details"}),e.jsx("div",{className:"modal-body overflow-y-auto",children:e.jsx("table",{className:"table-auto w-full border-collapse border border-gray-300 bg-light",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Profile Picture"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 flex items-center justify-between gap-2",children:[e.jsx("img",{src:L,width:50,alt:"Profile",className:"cursor-pointer",onClick:()=>v(!0)}),e.jsx("button",{onClick:E,className:"bg-blue-500 text-white px-3 py-1 rounded",disabled:j,children:j?"Updating...":"Allow Update"})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Name"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.name})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Email"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.email})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Contact"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.phone})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Payment Status"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 flex justify-between font-semibold text-blue-600",children:[e.jsx("p",{children:d||"N/A"}),d==="authorized"&&e.jsx("div",{className:"flex gap-2 align-items-center",children:e.jsx("button",{onClick:()=>{var a;return G((a=s[0])==null?void 0:a.paymentId)},className:"bg-green-500 text-white px-3 py-1 rounded",children:"Capture Payment"})}),!t.paymentVerified&&e.jsx("button",{className:"bg-green-500 text-white px-3 py-1 rounded",onClick:Q,children:"Verify Payment"})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:`${(F=t==null?void 0:t.address)==null?void 0:F.area} ${(R=t==null?void 0:t.address)==null?void 0:R.city} ${(T=t==null?void 0:t.address)==null?void 0:T.state} ${(_=t==null?void 0:t.address)==null?void 0:_.country} ${(Y=t==null?void 0:t.address)==null?void 0:Y.pincode}`})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Name"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.businessName})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Category"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 capitalize",children:t.businessCategory})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.businessAddress})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Aadhar"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 flex items-center justify-between gap-2",children:[r.filter(Boolean).length>0?e.jsx("div",{className:"flex gap-2",children:r.map((a,n)=>a&&e.jsx("img",{src:a,width:50,alt:`Aadhar ${n+1}`,className:"cursor-pointer",onClick:()=>i(n)},n))}):e.jsx("span",{className:"",children:"N/A"}),r.filter(Boolean).length>0&&e.jsx("div",{className:"flex flex-col justify-center",children:e.jsx("button",{onClick:$,className:"bg-yellow-500 text-white btn-sm px-4 py-1 rounded",disabled:j,children:j?"Deleting...":"Reset e-KYC"})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Permanent Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:y||"N/A"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Aadhar Number"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:N||"N/A"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Account Holder Name"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:((K=t==null?void 0:t.ekyc)==null?void 0:K.accountHolderName)||"N/A"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Bank Account Number"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:((H=t==null?void 0:t.ekyc)==null?void 0:H.bankAccountNumber)||"N/A"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"IFSC Code"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:((O=t==null?void 0:t.ekyc)==null?void 0:O.ifscCode)||"N/A"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Bank Proof"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:(V=t==null?void 0:t.ekyc)!=null&&V.bankProof?e.jsx("img",{src:t.ekyc.bankProof,width:50,alt:"Bank Proof",className:"cursor-pointer"}):e.jsx("span",{className:"",children:"N/A"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"PAN Card Front"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:(M=t==null?void 0:t.ekyc)!=null&&M.panCardfront?e.jsx("img",{src:t.ekyc.panCardfront,width:50,alt:"PAN Card Front",className:"cursor-pointer"}):e.jsx("span",{className:"text-gray-800",children:"N/A"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"PAN Card Back"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:(q=t==null?void 0:t.ekyc)!=null&&q.panCardback?e.jsx("img",{src:t.ekyc.panCardback,width:50,alt:"PAN Card Back",className:"cursor-pointer"}):e.jsx("span",{className:"",children:"N/A"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"eKYC Status"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t!=null&&t.ekyc?(J=t==null?void 0:t.ekyc)==null?void 0:J.status:"N/A"})]})]})})}),e.jsx("div",{className:"flex justify-end m-0 gap-1 ",children:e.jsx("button",{onClick:k,className:"btn btn-secondary w-full sm:w-auto",children:"Close"})})]}),h!==null&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-[60]",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg flex relative",children:[e.jsx("button",{onClick:U,className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full",children:"✖"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>A(-1),className:"px-4 py-2 bg-gray-300 rounded",children:"⬅"}),e.jsx("img",{src:r[h],className:"max-w-[70%] max-h-[90vh] object-contain mx-4",alt:"Zoomed Aadhar"}),e.jsx("button",{onClick:()=>A(1),className:"px-4 py-2 bg-gray-300 rounded",children:"➡"})]}),e.jsxs("div",{className:"flex flex-col gap-4 w-1/3 p-4",children:[e.jsx("input",{type:"text",className:"border p-2 w-full",placeholder:"Aadhar Number",value:N,onChange:a=>S(a.target.value)}),e.jsx("input",{type:"text",className:"border p-2 w-full",placeholder:"Permanent Address",value:y,onChange:a=>P(a.target.value)}),e.jsx("button",{onClick:o,className:"bg-blue-500 text-white px-4 py-2 rounded",disabled:j,children:j?"Saving...":"Save"})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-[60]",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg relative",children:[e.jsx("button",{onClick:()=>v(!1),className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full",children:"✖"}),e.jsx("img",{src:t.profilePic,className:"max-w-full max-h-[90vh] object-contain",alt:"Zoomed Profile"})]})})]})},ne=()=>{const[t,k]=m.useState([]),[D,f]=m.useState(null),[h,w]=m.useState(""),[b,v]=m.useState(""),y=X(),[P,N]=m.useState(1);m.useState(1);const[S,j]=m.useState(10),x=async()=>{var s,d;try{const r=await g.get(`${p}/auth/getAllUser`);console.log(r.data,"response.data");const o=r.data.user.filter(i=>i.isAdminApproved===!0);k(o)}catch(r){console.error("Error:",r.message),c((d=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:d.message)}};m.useEffect(()=>{x()},[P,S]);const L=async s=>{c.info(e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to delete?"}),e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>I(s),children:"Yes"}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:c.dismiss,children:"No"})]})]}),{autoClose:!0,closeOnClick:!0})},I=async s=>{var d,r,o;c.dismiss();try{const i=await g.delete(`${p}/auth/deleteUser`,{headers:{"Content-Type":"application/json"},data:{id:s}});i.status===200&&(c((d=i==null?void 0:i.data)==null?void 0:d.message),x())}catch(i){console.error("Error:",i.message),c((o=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:o.message)}};m.useEffect(()=>{x()},[]);const u=t.filter(s=>s.name.toLowerCase().includes(h.toLowerCase())||s.email.toLowerCase().includes(h.toLowerCase())||s.phone.includes(h)||s.businessCategory.some(d=>d.toLowerCase().includes(h.toLowerCase()))).sort((s,d)=>b==="A-Z"?d.name.localeCompare(s.name):b==="Z-A"?s.name.localeCompare(d.name):b==="oldest-newest"?new Date(d.createdAt)-new Date(s.createdAt):b==="newest-oldest"?new Date(s.createdAt)-new Date(d.createdAt):0),Z=async s=>{var d,r;if(console.log(s,"referredById"),!!s)try{const o=await g.get(`${p}/auth/getUserById/${s}`);f(o.data.user)}catch(o){console.error("Error fetching referred user:",o.message),c(((r=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:r.message)||"Failed to fetch referred user details")}};return e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsx(se,{}),e.jsxs("div",{className:"my-32",children:[e.jsx("section",{children:e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"card bg-base-100 shadow-xl mt-5",children:[e.jsx("div",{className:"card-header text-xl font-bold py-3",children:"All Users"}),e.jsxs("div",{className:"p-3",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by Name, Email, Phone or Buisness Category",value:h,onChange:s=>w(s.target.value)}),e.jsxs("select",{className:"form-select mt-2",value:b,onChange:s=>v(s.target.value),children:[e.jsx("option",{value:"",children:"Sort By"}),e.jsx("option",{value:"A-Z",children:"A-Z"}),e.jsx("option",{value:"Z-A",children:"Z-A"}),e.jsx("option",{value:"oldest-newest",children:"Oldest-Newest"}),e.jsx("option",{value:"newest-oldest",children:"Newest-Oldest"})]})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table table-bordered border",children:[e.jsx("thead",{className:"text-bold text-[15px] text-black bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{children:"SrNo"}),e.jsx("th",{children:"DateTime"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"BuisnessCategory"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Referred By"}),e.jsx("th",{children:"UserStatus"}),e.jsx("th",{children:"Payment Status"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Remarks"})]})}),e.jsx("tbody",{children:u.map((s,d)=>{var r,o,i,U,A,$,B;return e.jsxs("tr",{children:[e.jsx("th",{children:(P-1)*S+d+1}),e.jsx("td",{className:"text-sm",children:new Date(s.createdAt).toLocaleString()}),e.jsx("td",{className:"text-sm",children:s.name}),e.jsx("td",{className:"text-sm capitalize",children:s.businessCategory[0]}),e.jsx("td",{className:"text-sm",children:s.phone}),e.jsx("td",{className:"text-sm",children:`${(r=s==null?void 0:s.address)==null?void 0:r.area}, ${(o=s==null?void 0:s.address)==null?void 0:o.city}, ${(i=s==null?void 0:s.address)==null?void 0:i.state}, ${(U=s==null?void 0:s.address)==null?void 0:U.country}, ${(A=s==null?void 0:s.address)==null?void 0:A.pincode}`}),e.jsx("td",{className:"text-sm",children:e.jsx("button",{className:"btn btn-light border border-gray-300 btn-sm",onClick:()=>{var E;return Z((E=s==null?void 0:s.referredBy[0])==null?void 0:E._id)},children:(($=s==null?void 0:s.referredBy)==null?void 0:$.length)>0?(B=s==null?void 0:s.referredBy[0])==null?void 0:B.name:"N/A"})}),e.jsxs("td",{className:"text-sm",children:[" ",(s==null?void 0:s.userstatus)==="available"?e.jsx("span",{className:"btn btn-sm btn-success",children:"available"}):e.jsx("span",{className:"btn btn-sm btn-danger",children:"unavailable"})]}),e.jsx("td",{className:"text-sm",children:s.paymentVerified?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-sm",children:e.jsxs("span",{className:"text-white flex items-center gap-2",children:["Payment ",e.jsx(te,{})]})}),e.jsx("button",{})]}):e.jsx("button",{className:"btn btn-danger btn-sm",children:e.jsxs("span",{className:"text-white flex items-center gap-2",children:["Payment"," ",e.jsx(ae,{size:17,className:""})]})})}),e.jsxs("td",{className:"d-flex",children:[e.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>f(s),children:"Details"}),e.jsx("button",{className:"btn btn-danger btn-sm ml-2",onClick:()=>L(s._id),children:"Delete"}),e.jsx("button",{className:"btn btn-warning text-white btn-sm ml-2",onClick:()=>y("/admin/editUser",{state:s}),children:"Edit"})]}),e.jsx("td",{className:"text-sm",children:e.jsx(re,{to:"/admin/users/addremark",state:{userId:s._id},className:"btn btn-sm btn-info",children:"Add Remarks"})})]},s._id)})})]})})]})})}),D&&e.jsx(de,{user:D,setSelectedUser:f,onClose:()=>f(null)})]})]})};export{ne as default};
