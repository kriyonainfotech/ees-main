import{r as c,j as e,m as P,w as B,c as S,B as g,A as E,e as U,P as z,L as D,i as L}from"./index-7-v_3dYh.js";import{s as M,a as _}from"./startSilver-5oWuoMuE.js";import{f as J,S as O}from"./Senedrequest-BkIb-q8X.js";import{$ as G}from"./module-DQ5BnsVo.js";import{k as w}from"./index-B2gehrhD.js";const A="https://ees121.com",H=({receivedRequest:i,setReceivedRequest:p})=>{console.log(i,"receivedRequest");const[d,j]=c.useState(null),[v,m]=c.useState(null),[f,b]=c.useState(0),u=JSON.parse(localStorage.getItem("token")),h=async(t,r,a)=>{console.log(t,a,r,"id, status, requestId");try{const o=a==="cancelled"?"cancelRequest":"updateRequestStatus",s=await S.post(`${A}/request/${o}`,{userId:t,requestId:r,status:a},{headers:{Authorization:`Bearer ${u}`}});console.log(s,"response"),s.status===200?(g.success(`Request ${a}`),m(a),p(n=>n.map(x=>x.requestId===r?{...x,status:a}:x))):g.error("Failed to update request")}catch(o){console.log(o,"error"),g.error("Failed to update request")}},R=t=>{j(t)},N=()=>{j(null),b(0)},y=async(t,r,a,o="")=>{if(console.log(t,r,a,o,"requestId, receiverId, ratingValue, comment"),!t||!r||!a){console.error("Missing rating data");return}try{const s=await S.post(`${A}/user/rate`,{requestId:t,receiverId:r,ratingValue:a,comment:o},{withCredentials:!0,headers:{Authorization:`Bearer ${u}`}});console.log("Rating submitted successfully:",s.data),s.status===200?(g.success(s.data.message||"Rating submitted successfully"),N()):g.error("Failed to submit rating")}catch(s){console.log("Error submitting rating:",s||s.message),g.error("Failed to submit rating")}},l=(t=0,r=10,a=!1)=>Array.from({length:r},(o,s)=>e.jsx("img",{src:s<t?M:_,alt:s<t?"Filled Star":"Empty Star",width:16,className:`cursor-pointer ${a?"hover:opacity-80":""}`,onClick:a?()=>b(s+1):void 0},s));return e.jsxs("div",{className:"mt-0",children:[e.jsx("section",{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 mt-4",children:i!=null&&i.length?i.map((t,r)=>{var a,o,s;return e.jsxs("div",{title:t.status==="cancelled"?"Sender has cancelled the request.":t.status==="rejected"?"Receiver has rejected the request.":t.status==="completed"?"Request completed, rate the user.":t.status==="accepted"?"Request accepted, contact the user.":"",className:`bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden ${t.status==="cancelled"||t.status==="rejected"?"opacity-50 grayscale":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{className:"w-full h-[400px] object-cover object-top",src:t.profilePic||P,alt:"Profile"}),e.jsx("span",{className:`absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-semibold text-white ${t.status==="accepted"?"bg-blue-600":t.status==="completed"?"bg-green-600":"bg-yellow-500"}`,children:t.status||"Pending"})]}),e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:t.name||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-600",children:t.email||"No email provided"}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("p",{className:"text-orange-600 text-sm font-medium capitalize",children:((a=t.businessCategory)==null?void 0:a.join(", "))||"N/A"}),e.jsx("p",{className:"text-xs text-gray-500",children:J(new Date(t.date),"PPpp")})]}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx("span",{className:"text-gray-800 text-sm pe-2",children:"User Rating:"}),l(((o=t==null?void 0:t.userrating)==null?void 0:o.value)||0,10),e.jsx("span",{className:"text-gray-700",children:((s=t==null?void 0:t.userrating)==null?void 0:s.value)||0})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-4 py-2 flex-1 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",onClick:()=>h(t.senderId,t.requestId,"accepted"),children:"Accept"}),e.jsx("button",{className:"px-4 py-2 flex-1 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",onClick:()=>h(t.senderId,t.requestId,"rejected"),children:"Reject"})]}),t.status==="accepted"&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`tel:${t.phone}`,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 text-white bg-green-600 rounded-lg hover:bg-green-700 transition",children:[e.jsx(B,{})," Contact Now"]}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",onClick:()=>h(t.senderId,t.requestId,"completed"),children:"Completed"})]}),t.status==="completed"&&e.jsx("button",{className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition",onClick:()=>R(t),children:"Rate User"})]})]})]},r)}):e.jsxs("div",{className:"col-span-3 text-center py-12",children:[e.jsx("h5",{children:"No Requests Found"}),e.jsx("p",{className:"text-gray-500",children:"Your received requests will appear here."})]})})}),d&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Rate ",d.name]}),e.jsx("div",{className:"flex justify-center mb-4",children:l(f,10,!0)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-400 text-white rounded-lg",onClick:N,children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg",onClick:()=>y(d.requestId,d.senderId,f),children:"Submit"})]})]})})]})},I="https://ees121.com",X=()=>{const i=JSON.parse(localStorage.getItem("token"))||null,[p,d]=c.useState([]),[j,v]=c.useState([]),[m,f]=c.useState("Sended Request"),[b,u]=c.useState(!0),[h,R]=c.useState(!1);c.useEffect(()=>{setTimeout(()=>R(!0),50)},[]),console.log(p,"receivedRequest");const N=[{id:1,name:"Sended Request"},{id:2,name:"Received Request"}],y=c.useCallback(async l=>{var r,a,o,s;if(!i){console.warn("⚠️ No authentication token found."),w.error("Authentication required!"),u(!1);return}u(!0);let t=l==="Sended Request"?`${I}/request/getSentRequests`:`${I}/request/getReceivedRequests`;try{const n=await S.get(t,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}});if(console.log(n.data,"response.data"),n.status===200&&n.data){const x={pending:1,accepted:2,completed:3,rated:4,rejected:5},k=((r=l==="Sended Request"?n.data.sendedRequests:n.data.receivedRequests)==null?void 0:r.sort(($,C)=>{const F=(x[$.status]||99)-(x[C.status]||99);return F!==0?F:new Date(C.date)-new Date($.date)}))||[];l==="Sended Request"?v(k):d(k)}else w.error(((a=n==null?void 0:n.data)==null?void 0:a.message)||"Error fetching requests")}catch(n){console.log(n,"error"),w.error(((s=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:s.message)||"Server error")}finally{u(!1)}},[i]);return c.useEffect(()=>{y(m)},[m,y]),h?e.jsxs(e.Fragment,{children:[e.jsx(E,{}),e.jsx(U,{}),e.jsx(z,{}),e.jsx("div",{className:"mt-40",children:e.jsx("section",{className:"bg-gray-50 py-5",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 d-flex gap-3",children:N.map(l=>e.jsx("div",{className:"receivReqBtn",children:e.jsx(D,{className:`btn rounded-lg ${m===l.name?"btn-success text-white":"bg-none border-black text-black"}`,onClick:()=>f(l.name),children:l.name})},l.id))}),e.jsx("div",{className:"mt-0",children:b?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"300px"},children:e.jsx(G,{color:"#00BFFF",height:50,width:50})}):m==="Received Request"?e.jsx(H,{receivedRequest:p,setReceivedRequest:d}):e.jsx(O,{sendedRequest:j,setSendedRequest:v})})]})})})}),e.jsx(L,{})]}):null};export{X as default};
