import{r as s,U as E,j as e,A as R,e as D,P as L,B as r,i as M,W as $,c as v}from"./index-CX9IpJ7M.js";const B="https://ees121.com",H=5*1024*1024,O=({onClose:a,onSubmit:g})=>{localStorage.getItem("token");const[o,C]=s.useState(1),[f,k]=s.useState(""),[m,p]=s.useState(""),[n,x]=s.useState({bankAccountNumber:"",ifscCode:"",accountHolderName:""}),[j,S]=s.useState(0),[w,y]=s.useState(!1),[c,u]=s.useState(null),[l,i]=s.useState({bankProof:null,panFront:null,panBack:null}),N=s.useRef(null),b=[121,200,300,400,500],A=(t,d)=>{const h=t.target.files[0];if(h){if(h.size>2*1024*1024){r.error("File size should not exceed 2MB.");return}URL.createObjectURL(h),i(P=>({...P,[d]:h}))}},F=t=>{u(t),y(!0)},I=()=>{const t=N.current.getScreenshot();t&&fetch(t).then(d=>d.blob()).then(d=>{const h=new File([d],`${c}.jpeg`,{type:"image/jpeg"});if(h.size>H){r.error("Captured image is too large. Please try again.");return}i(P=>({...P,[c]:h})),y(!1)})},U=()=>{if(o===1){if(!m&&(!n.bankAccountNumber||!n.ifscCode)){r.error("Please provide either UPI ID or complete bank details.");return}}else if(o===2){const t=f&&parseInt(f,10);if(t<120){r.error("Minimum withdrawal amount is ₹120");return}S(t)}C(o+1)},W=async()=>{if(/^[A-Z]{4}0[A-Z0-9]{6}$/.test(n.ifscCode)||r.error("Invalid IFSC code. It must be 11 characters long."),!l.bankProof||!l.panFront||!l.panBack){r.error("Please upload or capture all required documents.");return}const t=new FormData;t.append("bankProof",l.bankProof),t.append("panCardfront",l.panFront),t.append("panCardback",l.panBack),t.append("upiId",m||""),t.append("bankAccountNumber",n.bankAccountNumber||""),t.append("accountHolderName",n.accountHolderName||""),t.append("ifscCode",n.ifscCode||""),t.append("amount",j);try{const d=await v.post(`${B}/withdrawal/request`,t,{withCredentials:!0});console.log(d,"response of withdrawe request"),d.status===200?(r.success("Withdrawal request submitted successfully!"),g(payload),a()):r.error(d.message||"Failed to submit request")}catch(d){console.error("Error:",d),r.error("Something went wrong!")}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 p-5 ",children:e.jsx("div",{className:"bg-white w-full max-w-md rounded-lg shadow-lg p-4 relative lg:mt-20",children:e.jsxs("div",{className:"max-h-[50vh] lg:max-h-[60vh] overflow-y-auto p-2",children:[e.jsx("button",{className:"absolute top-2 right-4 bg-gray-200 hover:bg-gray-300 text-black rounded-full w-8 h-8 flex items-center justify-center",onClick:a,children:"✕"}),e.jsx("h2",{className:"text-xl font-semibold mb-4",children:o===1?"Enter Payment Details":o===2?"Select Withdrawal Amount":"Upload Documents"}),o===1&&e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2",children:[e.jsx("input",{type:"radio",checked:!!m,onChange:()=>p("")})," ","Use UPI"]}),e.jsx("input",{type:"text",className:"w-full border p-2 mb-4",placeholder:"Enter UPI ID",value:m,onChange:t=>p(t.target.value)}),e.jsxs("label",{className:"block mb-2",children:[e.jsx("input",{type:"radio",checked:!m,onChange:()=>p(null)})," ","Use Bank Details"]}),!m&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",className:"w-full border p-2 mb-2",placeholder:"Account Number",value:n.bankAccountNumber,onChange:t=>x({...n,bankAccountNumber:t.target.value})}),e.jsx("input",{type:"text",className:"w-full border p-2 mb-2",placeholder:"IFSC Code",value:n.ifscCode,onChange:t=>x({...n,ifscCode:t.target.value})}),e.jsx("input",{type:"text",className:"w-full border p-2 mb-2",placeholder:"Account Holder Name",value:n.accountHolderName,onChange:t=>x({...n,accountHolderName:t.target.value})})]})]}),o===2&&e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:b.map(t=>e.jsxs("button",{className:`px-4 py-2 rounded-md border ${f===t?"bg-blue-600 text-white":"bg-gray-200"}`,onClick:()=>k(t),children:["₹",t]},t))}),e.jsx("input",{type:"number",value:f,onChange:t=>k(t.target.value),className:"border rounded-md p-2 mt-3 w-full"})]}),o===3&&e.jsxs("div",{children:[e.jsx("button",{className:"w-full p-2 bg-blue-600 text-white mb-2",onClick:()=>F("bankProof"),children:"Capture Bank Proof"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>A(t,"bankProof"),className:"w-full border p-2 mb-2"}),l.bankProof&&e.jsx("img",{src:URL.createObjectURL(l.bankProof),alt:"Bank Proof",className:"w-20 h-20 mt-2 rounded-md"}),e.jsx("button",{className:"w-full p-2 bg-blue-600 text-white mb-2",onClick:()=>F("panFront"),children:"Capture PAN Front"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>A(t,"panFront"),className:"w-full border p-2 mb-2"}),l.panFront&&e.jsx("img",{src:URL.createObjectURL(l.panFront),alt:"PAN Front",className:"w-20 h-20 mt-2 rounded-md"}),e.jsx("button",{className:"w-full p-2 bg-blue-600 text-white mb-2",onClick:()=>F("panBack"),children:"Capture PAN Back"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>A(t,"panBack"),className:"w-full border p-2 mb-2"}),l.panBack&&e.jsx("img",{src:URL.createObjectURL(l.panBack),alt:"PAN Back",className:"w-20 h-20 mt-2 rounded-md"})]}),w&&e.jsxs("div",{className:"mt-4",children:[e.jsx($,{ref:N,screenshotFormat:"image/jpeg",className:"w-full h-48"}),e.jsx("button",{className:"w-full p-2 bg-green-600 text-white mt-2",onClick:I,children:"Capture Image"})]}),e.jsxs("div",{className:"flex justify-between mt-4",children:[o>1&&e.jsx("button",{className:"p-2 bg-gray-400 rounded",onClick:()=>C(o-1),children:"Back"}),o<3?e.jsx("button",{className:"p-2 bg-blue-600 text-white rounded",onClick:U,children:"Next"}):e.jsx("button",{className:"p-2 bg-green-600 text-white rounded",onClick:W,children:"Submit Request"})]})]})})})},_=()=>{const{user:a}=s.useContext(E);console.log(a,"user");const[g,o]=s.useState(0),[C,f]=s.useState([]),[k,m]=s.useState(0),[p,n]=s.useState(!0),[x,j]=s.useState(""),[S,w]=s.useState(!1);s.useEffect(()=>{(async()=>{var u,l;if(!(a!=null&&a._id)){j("User is not authenticated"),n(!1);return}try{const i=await v.get(`${B}/referal/getUserWalletBalance/${a._id}`);console.log(i.data,"wallete"),o(i.data.walletBalance),f(i.data.earningsHistory||[])}catch(i){j(((l=(u=i==null?void 0:i.response)==null?void 0:u.data)==null?void 0:l.message)||"Error fetching wallet balance")}finally{n(!1)}})()},[a==null?void 0:a._id]);const y=()=>{var c,u;if(((c=a==null?void 0:a.ekyc)==null?void 0:c.status)==="pending"){r.warning("Your KYC details are waiting for admin's approval.");return}if(((u=a==null?void 0:a.ekyc)==null?void 0:u.status)!=="approved"){r.error("Your KYC is not approved yet. Please complete your KYC.");return}if(g<120){r.warning("Minimum withdrawal amount is ₹120");return}w(!0)};return s.useEffect(()=>{let c=!0;const u=new AbortController;return(async()=>{var i,N;if(a!=null&&a._id)try{n(!0);const b=await v.get(`${B}/referal/earnings/${a._id}`,{signal:u.signal});c&&b.status===200&&(m(b.data.earnings),j(null))}catch(b){c&&(console.error("[ERROR] Failed to fetch earnings:",b),v.isCancel(b)||(j(((N=(i=b.response)==null?void 0:i.data)==null?void 0:N.message)||"Failed to fetch earnings"),r.error("Error loading earnings data.")))}finally{c&&n(!1)}})(),()=>{c=!1,u.abort()}},[a==null?void 0:a._id]),e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsx(D,{}),e.jsx(L,{}),e.jsx("div",{className:"mt-40",children:e.jsx("div",{className:"container",children:e.jsx("section",{className:"",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"wallete px-0",children:e.jsx("div",{className:"w-full flex flex-col items-center justify-center p-6 my-5 bg-red-100 rounded-lg shadow-md",children:p?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"spinner-border text-danger",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})})}):x?e.jsx("div",{className:"w-full text-center p-3 bg-red-200 text-red-800 rounded-lg",children:x}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full flex justify-end mb-4",children:e.jsx("button",{className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md disabled:bg-gray-400",onClick:y,children:p?"Loading...":`Withdraw ₹${g>=120?g:0}`})}),S&&e.jsx(O,{onClose:()=>w(!1),onSubmit:c=>{console.log("Withdrawal Request Data:",c),w(!1),r.success("Withdrawal request submitted!")}}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 w-full",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total Wallet Balance"}),p?e.jsx("div",{className:"animate-spin h-6 w-6 border-t-4 border-blue-500 rounded-full mt-2"}):e.jsxs("h3",{className:"text-3xl font-bold text-blue-600",children:["₹",g||0]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total Earnings"}),p?e.jsx("div",{className:"animate-spin h-6 w-6 border-t-4 border-green-500 rounded-full mt-2"}):e.jsxs("h3",{className:"text-3xl font-bold text-green-600",children:["₹",k||0]})]})]})]})})})})})})}),e.jsx(M,{})]})},Y=s.memo(_);export{Y as default};
